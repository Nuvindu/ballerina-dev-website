{"pageProps":{"samples":{"code":"<pre class=\"shiki github-light\" style=\"background-color: #fff\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #D73A49\">import</span><span style=\"color: #24292E\"> ballerina/log;</span></span>\n<span class=\"line\"><span style=\"color: #D73A49\">import</span><span style=\"color: #24292E\"> ballerinax/github;</span></span>\n<span class=\"line\"><span style=\"color: #D73A49\">import</span><span style=\"color: #24292E\"> wso2/choreo.sendemail </span><span style=\"color: #D73A49\">as</span><span style=\"color: #24292E\"> email;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #D73A49\">configurable</span><span style=\"color: #24292E\"> </span><span style=\"color: #005CC5\">string</span><span style=\"color: #24292E\"> githubAccessToken </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">?</span><span style=\"color: #24292E\">;</span></span>\n<span class=\"line\"><span style=\"color: #D73A49\">configurable</span><span style=\"color: #24292E\"> </span><span style=\"color: #005CC5\">string</span><span style=\"color: #24292E\"> repositoryName </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">?</span><span style=\"color: #24292E\">;</span></span>\n<span class=\"line\"><span style=\"color: #D73A49\">configurable</span><span style=\"color: #24292E\"> </span><span style=\"color: #005CC5\">string</span><span style=\"color: #24292E\"> repositoryOwner </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">?</span><span style=\"color: #24292E\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #D73A49\">configurable</span><span style=\"color: #24292E\"> </span><span style=\"color: #005CC5\">string</span><span style=\"color: #24292E\"> recipientAddress </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">?</span><span style=\"color: #24292E\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #D73A49\">public</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">function</span><span style=\"color: #24292E\"> </span><span style=\"color: #6F42C1\">main</span><span style=\"color: #24292E\">() </span><span style=\"color: #D73A49\">returns</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">error?</span><span style=\"color: #24292E\"> {</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    github</span><span style=\"color: #D73A49\">:</span><span style=\"color: #24292E\">Client githubClient </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">check</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">new</span><span style=\"color: #24292E\"> ({auth</span><span style=\"color: #D73A49\">:</span><span style=\"color: #24292E\"> {token: githubAccessToken}});</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #D73A49\">stream&lt;</span><span style=\"color: #24292E\">github</span><span style=\"color: #D73A49\">:</span><span style=\"color: #24292E\">User,github</span><span style=\"color: #D73A49\">:</span><span style=\"color: #24292E\">Error?</span><span style=\"color: #D73A49\">&gt;</span><span style=\"color: #24292E\"> collaborators </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">check</span><span style=\"color: #24292E\"> githubClient</span><span style=\"color: #D73A49\">-&gt;</span><span style=\"color: #6F42C1\">getCollaborators</span><span style=\"color: #24292E\">(</span><span style=\"color: #E36209\">repositoryOwner</span><span style=\"color: #24292E\">, </span><span style=\"color: #E36209\">repositoryName</span><span style=\"color: #24292E\">);</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    log</span><span style=\"color: #D73A49\">:</span><span style=\"color: #6F42C1\">printInfo</span><span style=\"color: #24292E\">(</span><span style=\"color: #032F62\">&quot;Started compiling the report&quot;</span><span style=\"color: #24292E\">);</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #005CC5\">string</span><span style=\"color: #24292E\"> assigneeSummary </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #032F62\">&quot;&quot;</span><span style=\"color: #24292E\">;</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #D73A49\">check</span><span style=\"color: #24292E\"> collaborators.</span><span style=\"color: #6F42C1\">forEach</span><span style=\"color: #24292E\">(</span><span style=\"color: #D73A49\">function</span><span style=\"color: #24292E\"> (</span><span style=\"color: #E36209\">github</span><span style=\"color: #D73A49\">:</span><span style=\"color: #24292E\">User user ){</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">        </span><span style=\"color: #005CC5\">string</span><span style=\"color: #24292E\"> query </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #032F62\">&quot;repo:&quot;</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">+</span><span style=\"color: #24292E\"> repositoryOwner </span><span style=\"color: #D73A49\">+</span><span style=\"color: #24292E\"> </span><span style=\"color: #032F62\">&quot;/&quot;</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">+</span><span style=\"color: #24292E\"> repositoryName </span><span style=\"color: #D73A49\">+</span><span style=\"color: #24292E\"> </span><span style=\"color: #032F62\">&quot; is:issue assignee:&quot;</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">+</span><span style=\"color: #24292E\"> user.login;</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">        github</span><span style=\"color: #D73A49\">:</span><span style=\"color: #24292E\">SearchResult</span><span style=\"color: #D73A49\">|</span><span style=\"color: #24292E\">github:Error issuesForAssignee </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> githubClient</span><span style=\"color: #D73A49\">-&gt;</span><span style=\"color: #24292E\"> </span><span style=\"color: #6F42C1\">search</span><span style=\"color: #24292E\">(</span><span style=\"color: #E36209\">query</span><span style=\"color: #24292E\">, </span><span style=\"color: #E36209\">github</span><span style=\"color: #D73A49\">:</span><span style=\"color: #24292E\">SEARCH_TYPE_ISSUE, </span><span style=\"color: #005CC5\">1</span><span style=\"color: #24292E\">);</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">        </span><span style=\"color: #D73A49\">if</span><span style=\"color: #24292E\"> issuesForAssignee </span><span style=\"color: #D73A49\">is</span><span style=\"color: #24292E\"> github</span><span style=\"color: #D73A49\">:</span><span style=\"color: #24292E\">SearchResult {</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">            </span><span style=\"color: #005CC5\">string</span><span style=\"color: #24292E\"> userName </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> user?.name </span><span style=\"color: #D73A49\">?:</span><span style=\"color: #24292E\"> </span><span style=\"color: #032F62\">&quot;Unknown Name&quot;</span><span style=\"color: #24292E\">;</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">            assigneeSummary </span><span style=\"color: #D73A49\">+=</span><span style=\"color: #24292E\"> </span><span style=\"color: #005CC5\">string</span><span style=\"color: #24292E\"> </span><span style=\"color: #032F62\">`${</span><span style=\"color: #24292E\">userName</span><span style=\"color: #032F62\">} : ${</span><span style=\"color: #24292E\">issuesForAssignee</span><span style=\"color: #032F62\">.</span><span style=\"color: #24292E\">issueCount</span><span style=\"color: #032F62\">} ${&quot;</span><span style=\"color: #005CC5\">\\n</span><span style=\"color: #032F62\">&quot;}`</span><span style=\"color: #24292E\">;</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">        } </span><span style=\"color: #D73A49\">else</span><span style=\"color: #24292E\"> {</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">            log</span><span style=\"color: #D73A49\">:</span><span style=\"color: #6F42C1\">printError</span><span style=\"color: #24292E\">(</span><span style=\"color: #032F62\">&quot;Error while searching issues of an assignee.&quot;</span><span style=\"color: #24292E\">,&#39;error </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> issuesForAssignee);</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">        }</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    });</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">  </span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #005CC5\">string</span><span style=\"color: #24292E\"> query1 </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #032F62\">&quot;repo:&quot;</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">+</span><span style=\"color: #24292E\"> repositoryOwner </span><span style=\"color: #D73A49\">+</span><span style=\"color: #24292E\"> </span><span style=\"color: #032F62\">&quot;/&quot;</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">+</span><span style=\"color: #24292E\"> repositoryName </span><span style=\"color: #D73A49\">+</span><span style=\"color: #24292E\"> </span><span style=\"color: #032F62\">&quot; is:issue is:open&quot;</span><span style=\"color: #24292E\">;</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    github</span><span style=\"color: #D73A49\">:</span><span style=\"color: #24292E\">SearchResult</span><span style=\"color: #D73A49\">|</span><span style=\"color: #24292E\">github:Error openIssues </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> githubClient</span><span style=\"color: #D73A49\">-&gt;</span><span style=\"color: #24292E\"> </span><span style=\"color: #6F42C1\">search</span><span style=\"color: #24292E\">(</span><span style=\"color: #E36209\">query1</span><span style=\"color: #24292E\">, </span><span style=\"color: #E36209\">github</span><span style=\"color: #D73A49\">:</span><span style=\"color: #24292E\">SEARCH_TYPE_ISSUE, </span><span style=\"color: #005CC5\">1</span><span style=\"color: #24292E\">);</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #D73A49\">if</span><span style=\"color: #24292E\"> openIssues </span><span style=\"color: #D73A49\">is</span><span style=\"color: #24292E\"> github</span><span style=\"color: #D73A49\">:</span><span style=\"color: #24292E\">Error {</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">        log</span><span style=\"color: #D73A49\">:</span><span style=\"color: #6F42C1\">printError</span><span style=\"color: #24292E\">(</span><span style=\"color: #032F62\">&quot;Error while searching open issues.&quot;</span><span style=\"color: #24292E\">, &#39;error </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> openIssues);</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    }</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #005CC5\">int</span><span style=\"color: #24292E\"> totalOpenIssueCount </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> openIssues </span><span style=\"color: #D73A49\">is</span><span style=\"color: #24292E\"> github</span><span style=\"color: #D73A49\">:</span><span style=\"color: #24292E\">SearchResult? openIssues.issueCount </span><span style=\"color: #D73A49\">:</span><span style=\"color: #24292E\"> </span><span style=\"color: #005CC5\">0</span><span style=\"color: #24292E\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #005CC5\">string</span><span style=\"color: #24292E\"> query2 </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #032F62\">&quot;repo:&quot;</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">+</span><span style=\"color: #24292E\"> repositoryOwner </span><span style=\"color: #D73A49\">+</span><span style=\"color: #24292E\"> </span><span style=\"color: #032F62\">&quot;/&quot;</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">+</span><span style=\"color: #24292E\"> repositoryName </span><span style=\"color: #D73A49\">+</span><span style=\"color: #24292E\"> </span><span style=\"color: #032F62\">&quot; is:issue is:closed&quot;</span><span style=\"color: #24292E\">;</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    github</span><span style=\"color: #D73A49\">:</span><span style=\"color: #24292E\">SearchResult</span><span style=\"color: #D73A49\">|</span><span style=\"color: #24292E\">github:Error closedIssues </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> githubClient</span><span style=\"color: #D73A49\">-&gt;</span><span style=\"color: #24292E\"> </span><span style=\"color: #6F42C1\">search</span><span style=\"color: #24292E\">(</span><span style=\"color: #E36209\">query2</span><span style=\"color: #24292E\">, </span><span style=\"color: #E36209\">github</span><span style=\"color: #D73A49\">:</span><span style=\"color: #24292E\">SEARCH_TYPE_ISSUE, </span><span style=\"color: #005CC5\">1</span><span style=\"color: #24292E\">);</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #D73A49\">if</span><span style=\"color: #24292E\"> closedIssues </span><span style=\"color: #D73A49\">is</span><span style=\"color: #24292E\"> github</span><span style=\"color: #D73A49\">:</span><span style=\"color: #24292E\">Error {</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">        log</span><span style=\"color: #D73A49\">:</span><span style=\"color: #6F42C1\">printError</span><span style=\"color: #24292E\">(</span><span style=\"color: #032F62\">&quot;Error while searching closed issues.&quot;</span><span style=\"color: #24292E\">, &#39;error </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> closedIssues);</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    }</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #005CC5\">int</span><span style=\"color: #24292E\"> totalClosedIssueCount </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> closedIssues </span><span style=\"color: #D73A49\">is</span><span style=\"color: #24292E\"> github</span><span style=\"color: #D73A49\">:</span><span style=\"color: #24292E\">SearchResult? closedIssues.issueCount </span><span style=\"color: #D73A49\">:</span><span style=\"color: #005CC5\">0</span><span style=\"color: #24292E\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #005CC5\">string</span><span style=\"color: #24292E\"> issueSummary </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #005CC5\">string</span><span style=\"color: #24292E\"> </span><span style=\"color: #032F62\">`ISSUE SUMMARY REPORT${&quot;</span><span style=\"color: #005CC5\">\\n\\n</span><span style=\"color: #032F62\">&quot;}Repository Name: ${</span><span style=\"color: #24292E\">repositoryName</span><span style=\"color: #032F62\">}</span></span>\n<span class=\"line\"><span style=\"color: #032F62\">        ${&quot;</span><span style=\"color: #005CC5\">\\n</span><span style=\"color: #032F62\">&quot;}Total Issues Open: ${</span><span style=\"color: #24292E\">totalOpenIssueCount</span><span style=\"color: #032F62\">} ${&quot;</span><span style=\"color: #005CC5\">\\n</span><span style=\"color: #032F62\">&quot;}Total Issues Closed: ${</span><span style=\"color: #24292E\">totalClosedIssueCount</span><span style=\"color: #032F62\">}</span></span>\n<span class=\"line\"><span style=\"color: #032F62\">        ${&quot;</span><span style=\"color: #005CC5\">\\n\\n</span><span style=\"color: #032F62\">&quot;}Issue Count by Assignee: ${&quot;</span><span style=\"color: #005CC5\">\\n</span><span style=\"color: #032F62\">&quot;}${</span><span style=\"color: #24292E\">assigneeSummary</span><span style=\"color: #032F62\">} ${&quot;</span><span style=\"color: #005CC5\">\\n</span><span style=\"color: #032F62\">&quot;}`</span><span style=\"color: #24292E\">;</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    email</span><span style=\"color: #D73A49\">:</span><span style=\"color: #24292E\">Client emailClient </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">check</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">new</span><span style=\"color: #24292E\"> ();</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #005CC5\">string</span><span style=\"color: #24292E\"> sendEmailResponse </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">check</span><span style=\"color: #24292E\"> emailClient</span><span style=\"color: #D73A49\">-&gt;</span><span style=\"color: #6F42C1\">sendEmail</span><span style=\"color: #24292E\">(</span><span style=\"color: #E36209\">recipientAddress</span><span style=\"color: #24292E\">, </span><span style=\"color: #032F62\">&quot;Git Issue Summary&quot;</span><span style=\"color: #24292E\">, </span><span style=\"color: #E36209\">issueSummary</span><span style=\"color: #24292E\">);</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    log</span><span style=\"color: #D73A49\">:</span><span style=\"color: #6F42C1\">printInfo</span><span style=\"color: #24292E\">(</span><span style=\"color: #032F62\">&quot;Email sent successfully </span><span style=\"color: #005CC5\">\\n</span><span style=\"color: #032F62\"> &quot;</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">+</span><span style=\"color: #24292E\"> </span><span style=\"color: #E36209\">sendEmailResponse</span><span style=\"color: #24292E\">);</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">  }</span></span></code></pre>"},"content":"\nimport ballerina/log;\nimport ballerinax/github;\nimport wso2/choreo.sendemail as email;\n\nconfigurable string githubAccessToken = ?;\nconfigurable string repositoryName = ?;\nconfigurable string repositoryOwner = ?;\n\nconfigurable string recipientAddress = ?;\n\npublic function main() returns error? {\n    github:Client githubClient = check new ({auth: {token: githubAccessToken}});\n    stream<github:User,github:Error?> collaborators = check githubClient->getCollaborators(repositoryOwner, repositoryName);\n    log:printInfo(\"Started compiling the report\");\n    string assigneeSummary = \"\";\n    \n    check collaborators.forEach(function (github:User user ){\n        string query = \"repo:\" + repositoryOwner + \"/\" + repositoryName + \" is:issue assignee:\" + user.login;\n        github:SearchResult|github:Error issuesForAssignee = githubClient-> search(query, github:SEARCH_TYPE_ISSUE, 1);\n        if issuesForAssignee is github:SearchResult {\n            string userName = user?.name ?: \"Unknown Name\";\n            assigneeSummary += string `${userName} : ${issuesForAssignee.issueCount} ${\"\\n\"}`;\n        } else {\n            log:printError(\"Error while searching issues of an assignee.\",'error = issuesForAssignee);\n        }\n    });\n  \n    string query1 = \"repo:\" + repositoryOwner + \"/\" + repositoryName + \" is:issue is:open\";\n    github:SearchResult|github:Error openIssues = githubClient-> search(query1, github:SEARCH_TYPE_ISSUE, 1);\n    if openIssues is github:Error {\n        log:printError(\"Error while searching open issues.\", 'error = openIssues);\n    }\n    int totalOpenIssueCount = openIssues is github:SearchResult? openIssues.issueCount : 0;\n\n    string query2 = \"repo:\" + repositoryOwner + \"/\" + repositoryName + \" is:issue is:closed\";\n    github:SearchResult|github:Error closedIssues = githubClient-> search(query2, github:SEARCH_TYPE_ISSUE, 1);\n    if closedIssues is github:Error {\n        log:printError(\"Error while searching closed issues.\", 'error = closedIssues);\n    }\n    int totalClosedIssueCount = closedIssues is github:SearchResult? closedIssues.issueCount :0;\n\n    string issueSummary = string `ISSUE SUMMARY REPORT${\"\\n\\n\"}Repository Name: ${repositoryName}\n        ${\"\\n\"}Total Issues Open: ${totalOpenIssueCount} ${\"\\n\"}Total Issues Closed: ${totalClosedIssueCount}\n        ${\"\\n\\n\"}Issue Count by Assignee: ${\"\\n\"}${assigneeSummary} ${\"\\n\"}`;\n    email:Client emailClient = check new ();\n    string sendEmailResponse = check emailClient->sendEmail(recipientAddress, \"Git Issue Summary\", issueSummary);\n    log:printInfo(\"Email sent successfully \\n \" + sendEmailResponse);\n  }\n  \n"},"__N_SSG":true}