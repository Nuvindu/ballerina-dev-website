{"pageProps":{"samples":{"ai":{"frontmatter":{"title":"Utilize AI to extract sales information","description":"A Great amount of valuable sales-related information is captured in ad-hoc form such as emails, Word documents, and slides. Ballerina AI capabilities can be used to update Salesforce with information extracted from such unstructured data.<br/><br/><i>Example: Extract lead details such as name, phone number and company from emails using OpenAI, and create corresponding leads in Salesforce.</i>","url":"https://github.com/chathurace/integration-samples/blob/main/gmail-to-salesforce-lead/main.bal","image":""},"code":"<pre class=\"shiki github-light\" style=\"background-color: #fff\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #D73A49\">const </span><span style=\"color: #005CC5\">LABEL</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #032F62\">&quot;Lead&quot;</span><span style=\"color: #24292E\">;</span></span>\n<span class=\"line\"><span style=\"color: #D73A49\">final</span><span style=\"color: #24292E\"> gmail</span><span style=\"color: #D73A49\">:</span><span style=\"color: #24292E\">Client gmail </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">check</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">new</span><span style=\"color: #24292E\"> ({auth</span><span style=\"color: #D73A49\">:</span><span style=\"color: #24292E\"> {token: gmailAccessToken}});</span></span>\n<span class=\"line\"><span style=\"color: #D73A49\">final</span><span style=\"color: #24292E\"> chat</span><span style=\"color: #D73A49\">:</span><span style=\"color: #24292E\">Client openAiChat </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">check</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">new</span><span style=\"color: #24292E\"> ({auth</span><span style=\"color: #D73A49\">:</span><span style=\"color: #24292E\"> {token: openAIKey}});</span></span>\n<span class=\"line\"><span style=\"color: #D73A49\">final</span><span style=\"color: #24292E\"> sf</span><span style=\"color: #D73A49\">:</span><span style=\"color: #24292E\">Client salesforce </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">check</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">new</span><span style=\"color: #24292E\"> ({baseUrl</span><span style=\"color: #D73A49\">:</span><span style=\"color: #24292E\"> salesforceBaseUrl, auth</span><span style=\"color: #D73A49\">:</span><span style=\"color: #24292E\"> {token: salesforceAccessToken}});</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #D73A49\">public</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">function</span><span style=\"color: #24292E\"> </span><span style=\"color: #6F42C1\">main</span><span style=\"color: #24292E\">() </span><span style=\"color: #D73A49\">returns</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">error?</span><span style=\"color: #24292E\"> {</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    Email[] emails </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">check</span><span style=\"color: #24292E\"> </span><span style=\"color: #6F42C1\">getEmails</span><span style=\"color: #24292E\">(</span><span style=\"color: #E36209\">LABEL</span><span style=\"color: #24292E\">);</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    Lead[] leads </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">from</span><span style=\"color: #24292E\"> Email email </span><span style=\"color: #D73A49\">in</span><span style=\"color: #24292E\"> emails</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">        </span><span style=\"color: #D73A49\">let</span><span style=\"color: #24292E\"> Lead</span><span style=\"color: #D73A49\">?</span><span style=\"color: #24292E\"> lead </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #6F42C1\">generateLead</span><span style=\"color: #24292E\">(</span><span style=\"color: #E36209\">email</span><span style=\"color: #24292E\">)</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">        </span><span style=\"color: #D73A49\">where</span><span style=\"color: #24292E\"> lead </span><span style=\"color: #D73A49\">is</span><span style=\"color: #24292E\"> Lead</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">        </span><span style=\"color: #D73A49\">select</span><span style=\"color: #24292E\"> lead;</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #6F42C1\">addLeadsToSalesforce</span><span style=\"color: #24292E\">(</span><span style=\"color: #E36209\">leads</span><span style=\"color: #24292E\">);</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #D73A49\">function</span><span style=\"color: #24292E\"> </span><span style=\"color: #6F42C1\">getEmails</span><span style=\"color: #24292E\">(</span><span style=\"color: #005CC5\">string</span><span style=\"color: #24292E\"> </span><span style=\"color: #E36209\">label</span><span style=\"color: #24292E\">) </span><span style=\"color: #D73A49\">returns</span><span style=\"color: #24292E\"> Email[]</span><span style=\"color: #D73A49\">|error</span><span style=\"color: #24292E\"> {</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #005CC5\">string</span><span style=\"color: #24292E\">[] labelIdsToMatch </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">check</span><span style=\"color: #24292E\"> </span><span style=\"color: #6F42C1\">getLabelIds</span><span style=\"color: #24292E\">(</span><span style=\"color: #E36209\">gmail</span><span style=\"color: #24292E\">, [label]);</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #D73A49\">if</span><span style=\"color: #24292E\"> labelIdsToMatch.</span><span style=\"color: #6F42C1\">length</span><span style=\"color: #24292E\">() </span><span style=\"color: #D73A49\">==</span><span style=\"color: #24292E\"> </span><span style=\"color: #005CC5\">0</span><span style=\"color: #24292E\"> {</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">        </span><span style=\"color: #D73A49\">return</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">error</span><span style=\"color: #24292E\">(</span><span style=\"color: #032F62\">&quot;Unable to find any labels to match.&quot;</span><span style=\"color: #24292E\">);</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    }</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #24292E\">    gmail</span><span style=\"color: #D73A49\">:</span><span style=\"color: #24292E\">MailThread[] matchingMailThreads </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">check</span><span style=\"color: #24292E\"> </span><span style=\"color: #6F42C1\">getMatchingMailThreads</span><span style=\"color: #24292E\">(</span><span style=\"color: #E36209\">gmail</span><span style=\"color: #24292E\">, </span><span style=\"color: #E36209\">labelIdsToMatch</span><span style=\"color: #24292E\">);</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #6F42C1\">removeLabels</span><span style=\"color: #24292E\">(</span><span style=\"color: #E36209\">gmail</span><span style=\"color: #24292E\">, </span><span style=\"color: #E36209\">matchingMailThreads</span><span style=\"color: #24292E\">, </span><span style=\"color: #E36209\">labelIdsToMatch</span><span style=\"color: #24292E\">);</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    gmail</span><span style=\"color: #D73A49\">:</span><span style=\"color: #24292E\">Message[] matchingEmails </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #6F42C1\">getMatchingEmails</span><span style=\"color: #24292E\">(</span><span style=\"color: #E36209\">gmail</span><span style=\"color: #24292E\">, </span><span style=\"color: #E36209\">matchingMailThreads</span><span style=\"color: #24292E\">);</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #D73A49\">return</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">from</span><span style=\"color: #24292E\"> gmail</span><span style=\"color: #D73A49\">:</span><span style=\"color: #24292E\">Message message </span><span style=\"color: #D73A49\">in</span><span style=\"color: #24292E\"> matchingEmails</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">        </span><span style=\"color: #D73A49\">let</span><span style=\"color: #24292E\"> Email</span><span style=\"color: #D73A49\">|error</span><span style=\"color: #24292E\"> email </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #6F42C1\">parseEmail</span><span style=\"color: #24292E\">(</span><span style=\"color: #E36209\">message</span><span style=\"color: #24292E\">)</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">        </span><span style=\"color: #D73A49\">where</span><span style=\"color: #24292E\"> email </span><span style=\"color: #D73A49\">is</span><span style=\"color: #24292E\"> Email</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">        </span><span style=\"color: #D73A49\">select</span><span style=\"color: #24292E\"> email;</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #D73A49\">function</span><span style=\"color: #24292E\"> </span><span style=\"color: #6F42C1\">getLabelIds</span><span style=\"color: #24292E\">(</span><span style=\"color: #E36209\">gmail</span><span style=\"color: #D73A49\">:</span><span style=\"color: #24292E\">Client gmail, </span><span style=\"color: #005CC5\">string</span><span style=\"color: #24292E\">[] </span><span style=\"color: #E36209\">labelsToMatch</span><span style=\"color: #24292E\">) </span><span style=\"color: #D73A49\">returns</span><span style=\"color: #24292E\"> </span><span style=\"color: #005CC5\">string</span><span style=\"color: #24292E\">[]</span><span style=\"color: #D73A49\">|error</span><span style=\"color: #24292E\"> {</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    gmail</span><span style=\"color: #D73A49\">:</span><span style=\"color: #24292E\">LabelList labelList </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">check</span><span style=\"color: #24292E\"> gmail</span><span style=\"color: #D73A49\">-&gt;</span><span style=\"color: #6F42C1\">listLabels</span><span style=\"color: #24292E\">(</span><span style=\"color: #032F62\">&quot;me&quot;</span><span style=\"color: #24292E\">);</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #D73A49\">return</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">from</span><span style=\"color: #24292E\"> gmail</span><span style=\"color: #D73A49\">:</span><span style=\"color: #24292E\">Label {name, id} </span><span style=\"color: #D73A49\">in</span><span style=\"color: #24292E\"> labelList.labels</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">        </span><span style=\"color: #D73A49\">where</span><span style=\"color: #24292E\"> labelsToMatch.</span><span style=\"color: #6F42C1\">indexOf</span><span style=\"color: #24292E\">(</span><span style=\"color: #E36209\">name</span><span style=\"color: #24292E\">) </span><span style=\"color: #D73A49\">!=</span><span style=\"color: #24292E\"> ()</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">        </span><span style=\"color: #D73A49\">select</span><span style=\"color: #24292E\"> id;</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #D73A49\">function</span><span style=\"color: #24292E\"> </span><span style=\"color: #6F42C1\">getMatchingMailThreads</span><span style=\"color: #24292E\">(</span><span style=\"color: #E36209\">gmail</span><span style=\"color: #D73A49\">:</span><span style=\"color: #24292E\">Client gmail, </span><span style=\"color: #005CC5\">string</span><span style=\"color: #24292E\">[] </span><span style=\"color: #E36209\">labelIdsToMatch</span><span style=\"color: #24292E\">) </span><span style=\"color: #D73A49\">returns</span><span style=\"color: #24292E\"> gmail</span><span style=\"color: #D73A49\">:</span><span style=\"color: #24292E\">MailThread[]</span><span style=\"color: #D73A49\">|error</span><span style=\"color: #24292E\"> {</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    gmail</span><span style=\"color: #D73A49\">:</span><span style=\"color: #24292E\">MsgSearchFilter searchFilter </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> {</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">        includeSpamTrash</span><span style=\"color: #D73A49\">:</span><span style=\"color: #24292E\"> </span><span style=\"color: #005CC5\">false</span><span style=\"color: #24292E\">,</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">        labelIds</span><span style=\"color: #D73A49\">:</span><span style=\"color: #24292E\"> labelIdsToMatch</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    };</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #D73A49\">return</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">from</span><span style=\"color: #24292E\"> gmail</span><span style=\"color: #D73A49\">:</span><span style=\"color: #24292E\">MailThread mailThread </span><span style=\"color: #D73A49\">in</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">check</span><span style=\"color: #24292E\"> gmail-</span><span style=\"color: #D73A49\">&gt;</span><span style=\"color: #6F42C1\">listThreads</span><span style=\"color: #24292E\">(</span><span style=\"color: #E36209\">filter</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> searchFilter)</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">        </span><span style=\"color: #D73A49\">select</span><span style=\"color: #24292E\"> mailThread;</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #D73A49\">function</span><span style=\"color: #24292E\"> </span><span style=\"color: #6F42C1\">removeLabels</span><span style=\"color: #24292E\">(</span><span style=\"color: #E36209\">gmail</span><span style=\"color: #D73A49\">:</span><span style=\"color: #24292E\">Client gmail, </span><span style=\"color: #E36209\">gmail</span><span style=\"color: #D73A49\">:</span><span style=\"color: #24292E\">MailThread[] mailThreads, </span><span style=\"color: #005CC5\">string</span><span style=\"color: #24292E\">[] </span><span style=\"color: #E36209\">labelIds</span><span style=\"color: #24292E\">) {</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #D73A49\">foreach </span><span style=\"color: #24292E\">gmail</span><span style=\"color: #D73A49\">:</span><span style=\"color: #24292E\">MailThread mailThread </span><span style=\"color: #D73A49\">in</span><span style=\"color: #24292E\"> mailThreads {</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">        gmail</span><span style=\"color: #D73A49\">:</span><span style=\"color: #24292E\">MailThread</span><span style=\"color: #D73A49\">|error</span><span style=\"color: #24292E\"> removeLabelResponse </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> gmail</span><span style=\"color: #D73A49\">-&gt;</span><span style=\"color: #6F42C1\">modifyThread</span><span style=\"color: #24292E\">(mailThread.id, [], </span><span style=\"color: #E36209\">labelIds</span><span style=\"color: #24292E\">);</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">        </span><span style=\"color: #D73A49\">if</span><span style=\"color: #24292E\"> removeLabelResponse </span><span style=\"color: #D73A49\">is</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">error</span><span style=\"color: #24292E\"> {</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">            log</span><span style=\"color: #D73A49\">:</span><span style=\"color: #6F42C1\">printError</span><span style=\"color: #24292E\">(</span><span style=\"color: #032F62\">&quot;An error occured in removing the labels from the thread.&quot;</span><span style=\"color: #24292E\">,</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">                </span><span style=\"color: #E36209\">removeLabelResponse</span><span style=\"color: #24292E\">, removeLabelResponse.</span><span style=\"color: #6F42C1\">stackTrace</span><span style=\"color: #24292E\">(), </span><span style=\"color: #E36209\">threadId</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> mailThread.id, </span><span style=\"color: #E36209\">labelIds</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> labelIds);</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">        }</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    }</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #D73A49\">function</span><span style=\"color: #24292E\"> </span><span style=\"color: #6F42C1\">getMatchingEmails</span><span style=\"color: #24292E\">(</span><span style=\"color: #E36209\">gmail</span><span style=\"color: #D73A49\">:</span><span style=\"color: #24292E\">Client gmail, </span><span style=\"color: #E36209\">gmail</span><span style=\"color: #D73A49\">:</span><span style=\"color: #24292E\">MailThread[] mailThreads) </span><span style=\"color: #D73A49\">returns</span><span style=\"color: #24292E\"> gmail</span><span style=\"color: #D73A49\">:</span><span style=\"color: #24292E\">Message[] {</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    gmail</span><span style=\"color: #D73A49\">:</span><span style=\"color: #24292E\">Message[] messages </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> [];</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #D73A49\">foreach </span><span style=\"color: #24292E\">gmail</span><span style=\"color: #D73A49\">:</span><span style=\"color: #24292E\">MailThread mailThread </span><span style=\"color: #D73A49\">in</span><span style=\"color: #24292E\"> mailThreads {</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">        gmail</span><span style=\"color: #D73A49\">:</span><span style=\"color: #24292E\">MailThread</span><span style=\"color: #D73A49\">|error</span><span style=\"color: #24292E\"> response </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> gmail</span><span style=\"color: #D73A49\">-&gt;</span><span style=\"color: #6F42C1\">readThread</span><span style=\"color: #24292E\">(mailThread.id);</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">        </span><span style=\"color: #D73A49\">if</span><span style=\"color: #24292E\"> response </span><span style=\"color: #D73A49\">is</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">error</span><span style=\"color: #24292E\"> {</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">            log</span><span style=\"color: #D73A49\">:</span><span style=\"color: #6F42C1\">printError</span><span style=\"color: #24292E\">(</span><span style=\"color: #032F62\">&quot;An error occured while reading the email.&quot;</span><span style=\"color: #24292E\">,</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">                </span><span style=\"color: #E36209\">response</span><span style=\"color: #24292E\">, response.</span><span style=\"color: #6F42C1\">stackTrace</span><span style=\"color: #24292E\">(), </span><span style=\"color: #E36209\">threadId</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> mailThread.id);</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">            </span><span style=\"color: #D73A49\">continue</span><span style=\"color: #24292E\">;</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">        }</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #24292E\">        </span><span style=\"color: #D73A49\">if</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">!</span><span style=\"color: #24292E\">(response.messages </span><span style=\"color: #D73A49\">is</span><span style=\"color: #24292E\"> </span><span style=\"color: #E36209\">gmail</span><span style=\"color: #D73A49\">:</span><span style=\"color: #24292E\">Message[]) </span><span style=\"color: #D73A49\">||</span><span style=\"color: #24292E\"> (</span><span style=\"color: #D73A49\">&lt;</span><span style=\"color: #E36209\">gmail</span><span style=\"color: #D73A49\">:</span><span style=\"color: #24292E\">Message[]</span><span style=\"color: #D73A49\">&gt;</span><span style=\"color: #24292E\">response.messages).</span><span style=\"color: #6F42C1\">length</span><span style=\"color: #24292E\">() </span><span style=\"color: #D73A49\">&lt;</span><span style=\"color: #24292E\"> </span><span style=\"color: #005CC5\">1</span><span style=\"color: #24292E\"> {</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">            log</span><span style=\"color: #D73A49\">:</span><span style=\"color: #6F42C1\">printError</span><span style=\"color: #24292E\">(</span><span style=\"color: #032F62\">&quot;Unable to find any messages in the thread.&quot;</span><span style=\"color: #24292E\">, </span><span style=\"color: #E36209\">threadId</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> mailThread.id);</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">            </span><span style=\"color: #D73A49\">continue</span><span style=\"color: #24292E\">;</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">        }</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #24292E\">        messages.</span><span style=\"color: #6F42C1\">push</span><span style=\"color: #24292E\">((</span><span style=\"color: #D73A49\">&lt;</span><span style=\"color: #E36209\">gmail</span><span style=\"color: #D73A49\">:</span><span style=\"color: #24292E\">Message[]</span><span style=\"color: #D73A49\">&gt;</span><span style=\"color: #24292E\">response.messages)[</span><span style=\"color: #005CC5\">0</span><span style=\"color: #24292E\">]);</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    }</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #D73A49\">return</span><span style=\"color: #24292E\"> messages;</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #D73A49\">function</span><span style=\"color: #24292E\"> </span><span style=\"color: #6F42C1\">parseEmail</span><span style=\"color: #24292E\">(</span><span style=\"color: #E36209\">gmail</span><span style=\"color: #D73A49\">:</span><span style=\"color: #24292E\">Message message) </span><span style=\"color: #D73A49\">returns</span><span style=\"color: #24292E\"> Email</span><span style=\"color: #D73A49\">|error</span><span style=\"color: #24292E\"> {</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #D73A49\">do</span><span style=\"color: #24292E\"> {</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">        gmail</span><span style=\"color: #D73A49\">:</span><span style=\"color: #24292E\">MessageBodyPart bodyPart </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">check</span><span style=\"color: #24292E\"> message.emailBodyInText.</span><span style=\"color: #6F42C1\">ensureType</span><span style=\"color: #24292E\">(</span><span style=\"color: #E36209\">gmail</span><span style=\"color: #D73A49\">:</span><span style=\"color: #24292E\">MessageBodyPart);</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">        </span><span style=\"color: #005CC5\">string</span><span style=\"color: #24292E\"> bodyPartText </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">check</span><span style=\"color: #24292E\"> bodyPart.data.</span><span style=\"color: #6F42C1\">ensureType</span><span style=\"color: #24292E\">(</span><span style=\"color: #005CC5\">string</span><span style=\"color: #24292E\">);</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">        </span><span style=\"color: #005CC5\">string</span><span style=\"color: #24292E\"> body </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">check</span><span style=\"color: #24292E\"> mime</span><span style=\"color: #D73A49\">:</span><span style=\"color: #6F42C1\">base64Decode</span><span style=\"color: #24292E\">(</span><span style=\"color: #E36209\">bodyPartText</span><span style=\"color: #24292E\">).</span><span style=\"color: #6F42C1\">ensureType</span><span style=\"color: #24292E\">(</span><span style=\"color: #005CC5\">string</span><span style=\"color: #24292E\">);</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #24292E\">        </span><span style=\"color: #D73A49\">return</span><span style=\"color: #24292E\"> {</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">            &#39;from</span><span style=\"color: #D73A49\">:</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">check</span><span style=\"color: #24292E\"> message.headerFrom.</span><span style=\"color: #6F42C1\">ensureType</span><span style=\"color: #24292E\">(</span><span style=\"color: #005CC5\">string</span><span style=\"color: #24292E\">),</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">            subject</span><span style=\"color: #D73A49\">:</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">check</span><span style=\"color: #24292E\"> message.headerSubject.</span><span style=\"color: #6F42C1\">ensureType</span><span style=\"color: #24292E\">(</span><span style=\"color: #005CC5\">string</span><span style=\"color: #24292E\">),</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">            body</span><span style=\"color: #D73A49\">:</span><span style=\"color: #24292E\"> body</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">        };</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    } </span><span style=\"color: #D73A49\">on</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">fail</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">error</span><span style=\"color: #24292E\"> e {</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">        log</span><span style=\"color: #D73A49\">:</span><span style=\"color: #6F42C1\">printError</span><span style=\"color: #24292E\">(</span><span style=\"color: #032F62\">&quot;An error occured while parsing the email.&quot;</span><span style=\"color: #24292E\">, </span><span style=\"color: #E36209\">e</span><span style=\"color: #24292E\">, e.</span><span style=\"color: #6F42C1\">stackTrace</span><span style=\"color: #24292E\">(), </span><span style=\"color: #E36209\">message</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> message);</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">        </span><span style=\"color: #D73A49\">return</span><span style=\"color: #24292E\"> e;</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    }</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #D73A49\">function</span><span style=\"color: #24292E\"> </span><span style=\"color: #6F42C1\">generateLead</span><span style=\"color: #24292E\">(</span><span style=\"color: #E36209\">Email</span><span style=\"color: #24292E\"> </span><span style=\"color: #E36209\">email</span><span style=\"color: #24292E\">) </span><span style=\"color: #D73A49\">returns</span><span style=\"color: #24292E\"> Lead</span><span style=\"color: #D73A49\">?</span><span style=\"color: #24292E\"> {</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    chat</span><span style=\"color: #D73A49\">:</span><span style=\"color: #24292E\">CreateChatCompletionRequest request </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> {</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">        model</span><span style=\"color: #D73A49\">:</span><span style=\"color: #24292E\"> </span><span style=\"color: #032F62\">&quot;gpt-3.5-turbo&quot;</span><span style=\"color: #24292E\">,</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">        messages</span><span style=\"color: #D73A49\">:</span><span style=\"color: #24292E\"> [</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">            {</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">                </span><span style=\"color: #6F42C1\">role</span><span style=\"color: #24292E\">: </span><span style=\"color: #032F62\">&quot;user&quot;</span><span style=\"color: #24292E\">,</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">                </span><span style=\"color: #6F42C1\">content</span><span style=\"color: #24292E\">: </span><span style=\"color: #005CC5\">string</span><span style=\"color: #24292E\"> `</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">            Extract the following details in JSON from the email.</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">                {</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">                    </span><span style=\"color: #6F42C1\">firstName__c</span><span style=\"color: #24292E\">: </span><span style=\"color: #005CC5\">string</span><span style=\"color: #24292E\">, </span><span style=\"color: #6A737D\">// Mandatory</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">                    </span><span style=\"color: #6F42C1\">lastName__c</span><span style=\"color: #24292E\">: </span><span style=\"color: #005CC5\">string</span><span style=\"color: #24292E\">, </span><span style=\"color: #6A737D\">// Mandatory</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">                    </span><span style=\"color: #6F42C1\">email__c</span><span style=\"color: #24292E\">: </span><span style=\"color: #005CC5\">string</span><span style=\"color: #24292E\"> </span><span style=\"color: #6A737D\">// Mandatory</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">                    </span><span style=\"color: #6F42C1\">phoneNumber__c</span><span style=\"color: #24292E\">: </span><span style=\"color: #005CC5\">string</span><span style=\"color: #24292E\">, </span><span style=\"color: #6A737D\">// With country code. Use N/A if unable to find</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">                    </span><span style=\"color: #6F42C1\">company__c</span><span style=\"color: #24292E\">: </span><span style=\"color: #005CC5\">string</span><span style=\"color: #24292E\">, </span><span style=\"color: #6A737D\">// Mandatory</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">                    </span><span style=\"color: #6F42C1\">designation__c</span><span style=\"color: #24292E\">: </span><span style=\"color: #005CC5\">string</span><span style=\"color: #24292E\"> </span><span style=\"color: #6A737D\">// Not mandatory. Use N/A if unable to find</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">                }</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #24292E\">            Here is the </span><span style=\"color: #6F42C1\">email</span><span style=\"color: #24292E\">:    </span></span>\n<span class=\"line\"><span style=\"color: #24292E\">            {</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">                </span><span style=\"color: #6F42C1\">from</span><span style=\"color: #24292E\">: ${email.&#39;from},</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">                </span><span style=\"color: #6F42C1\">subject</span><span style=\"color: #24292E\">: ${email.subject},</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">                </span><span style=\"color: #6F42C1\">body</span><span style=\"color: #24292E\">: ${email.body}</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">            }</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">        `</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">            }</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">        ]</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    };</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #D73A49\">do</span><span style=\"color: #24292E\"> {</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">        chat</span><span style=\"color: #D73A49\">:</span><span style=\"color: #24292E\">CreateChatCompletionResponse response </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">check</span><span style=\"color: #24292E\"> openAiChat</span><span style=\"color: #D73A49\">-&gt;/</span><span style=\"color: #24292E\">chat</span><span style=\"color: #D73A49\">/</span><span style=\"color: #24292E\">completions.</span><span style=\"color: #6F42C1\">post</span><span style=\"color: #24292E\">(</span><span style=\"color: #E36209\">request</span><span style=\"color: #24292E\">);</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">        </span><span style=\"color: #D73A49\">if</span><span style=\"color: #24292E\"> response.choices.</span><span style=\"color: #6F42C1\">length</span><span style=\"color: #24292E\">() </span><span style=\"color: #D73A49\">&lt;</span><span style=\"color: #24292E\"> </span><span style=\"color: #005CC5\">1</span><span style=\"color: #24292E\"> {</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">            </span><span style=\"color: #D73A49\">check</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">error</span><span style=\"color: #24292E\">(</span><span style=\"color: #032F62\">&quot;Unable to find any choices in the response.&quot;</span><span style=\"color: #24292E\">);</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">        }</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">        </span><span style=\"color: #005CC5\">string</span><span style=\"color: #24292E\"> content </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">check</span><span style=\"color: #24292E\"> response.choices[</span><span style=\"color: #005CC5\">0</span><span style=\"color: #24292E\">].message?.content.</span><span style=\"color: #6F42C1\">ensureType</span><span style=\"color: #24292E\">(</span><span style=\"color: #005CC5\">string</span><span style=\"color: #24292E\">);</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">        </span><span style=\"color: #D73A49\">return</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">check</span><span style=\"color: #24292E\"> content.</span><span style=\"color: #6F42C1\">fromJsonStringWithType</span><span style=\"color: #24292E\">(</span><span style=\"color: #E36209\">Lead</span><span style=\"color: #24292E\">);</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    } </span><span style=\"color: #D73A49\">on</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">fail</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">error</span><span style=\"color: #24292E\"> e {</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">        log</span><span style=\"color: #D73A49\">:</span><span style=\"color: #6F42C1\">printError</span><span style=\"color: #24292E\">(</span><span style=\"color: #032F62\">&quot;An error occured while generating the lead.&quot;</span><span style=\"color: #24292E\">, </span><span style=\"color: #E36209\">e</span><span style=\"color: #24292E\">, e.</span><span style=\"color: #6F42C1\">stackTrace</span><span style=\"color: #24292E\">(), </span><span style=\"color: #E36209\">email</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> email);</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">        </span><span style=\"color: #D73A49\">return</span><span style=\"color: #24292E\">;</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    }</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #D73A49\">function</span><span style=\"color: #24292E\"> </span><span style=\"color: #6F42C1\">addLeadsToSalesforce</span><span style=\"color: #24292E\">(</span><span style=\"color: #E36209\">Lead</span><span style=\"color: #24292E\">[] </span><span style=\"color: #E36209\">leads</span><span style=\"color: #24292E\">) {</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #D73A49\">from</span><span style=\"color: #24292E\"> Lead lead </span><span style=\"color: #D73A49\">in</span><span style=\"color: #24292E\"> leads</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #D73A49\">do</span><span style=\"color: #24292E\"> {</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">        sf</span><span style=\"color: #D73A49\">:</span><span style=\"color: #24292E\">CreationResponse</span><span style=\"color: #D73A49\">|error</span><span style=\"color: #24292E\"> createResponse </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> salesforce</span><span style=\"color: #D73A49\">-&gt;</span><span style=\"color: #6F42C1\">create</span><span style=\"color: #24292E\">(</span><span style=\"color: #032F62\">&quot;EmailLead__c&quot;</span><span style=\"color: #24292E\">, </span><span style=\"color: #E36209\">lead</span><span style=\"color: #24292E\">);</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">        </span><span style=\"color: #D73A49\">if</span><span style=\"color: #24292E\"> createResponse </span><span style=\"color: #D73A49\">is</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">error</span><span style=\"color: #24292E\"> {</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">            log</span><span style=\"color: #D73A49\">:</span><span style=\"color: #6F42C1\">printError</span><span style=\"color: #24292E\">(</span><span style=\"color: #032F62\">&quot;An error occured while creating a Lead object on salesforce.&quot;</span><span style=\"color: #24292E\">,</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">                </span><span style=\"color: #E36209\">createResponse</span><span style=\"color: #24292E\">, createResponse.</span><span style=\"color: #6F42C1\">stackTrace</span><span style=\"color: #24292E\">(), </span><span style=\"color: #E36209\">lead</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> lead);</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">        } </span><span style=\"color: #D73A49\">else</span><span style=\"color: #24292E\"> {</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">            log</span><span style=\"color: #D73A49\">:</span><span style=\"color: #6F42C1\">printInfo</span><span style=\"color: #24292E\">(</span><span style=\"color: #032F62\">&quot;Lead successfully created.&quot;</span><span style=\"color: #24292E\">, </span><span style=\"color: #E36209\">lead</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> lead);</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">        }</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    };</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">}</span></span></code></pre>"},"b2b":{"frontmatter":{"title":"Integrate Salesforce with B2B Channels","description":"Interactions between businesses, such as sending purchase orders and invoices, usually occur over EDI-based B2B channels. Built-in EDI capabilities of Ballerina can directly integrate B2B channels with Salesforce and update sales data based on B2B transactions.<br/><br/><i>Example: Update products associated with Salesforce opportunities based on products listed in EDIFACT Request for Quotation (REQOTE) messages.</i>","url":"https://github.com/chathurace/integration-samples/blob/main/ftp-edi-message-to-salesforce-opportunity/main.bal","image":""},"code":"<pre class=\"shiki github-light\" style=\"background-color: #fff\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #24292E\">ftp</span><span style=\"color: #D73A49\">:</span><span style=\"color: #24292E\">Client fileServer </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">check</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">new</span><span style=\"color: #24292E\"> ftp</span><span style=\"color: #D73A49\">:</span><span style=\"color: #6F42C1\">Client</span><span style=\"color: #24292E\">(</span><span style=\"color: #E36209\">ftpConfig</span><span style=\"color: #24292E\">);</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">sf</span><span style=\"color: #D73A49\">:</span><span style=\"color: #24292E\">Client salesforce </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">check</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">new</span><span style=\"color: #24292E\"> (</span><span style=\"color: #E36209\">salesforceConfig</span><span style=\"color: #24292E\">);</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #D73A49\">public</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">function</span><span style=\"color: #24292E\"> </span><span style=\"color: #6F42C1\">main</span><span style=\"color: #24292E\">() </span><span style=\"color: #D73A49\">returns</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">error?</span><span style=\"color: #24292E\"> {</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    ftp</span><span style=\"color: #D73A49\">:</span><span style=\"color: #24292E\">FileInfo[] quoteList </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">check</span><span style=\"color: #24292E\"> fileServer</span><span style=\"color: #D73A49\">-&gt;</span><span style=\"color: #6F42C1\">list</span><span style=\"color: #24292E\">(</span><span style=\"color: #E36209\">ftpNewQuotesPath</span><span style=\"color: #24292E\">);</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #D73A49\">foreach </span><span style=\"color: #24292E\">ftp</span><span style=\"color: #D73A49\">:</span><span style=\"color: #24292E\">FileInfo quoteFile </span><span style=\"color: #D73A49\">in</span><span style=\"color: #24292E\"> quoteList {</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">        </span><span style=\"color: #005CC5\">string</span><span style=\"color: #D73A49\">|error</span><span style=\"color: #24292E\"> quoteText </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #6F42C1\">getFileText</span><span style=\"color: #24292E\">(</span><span style=\"color: #E36209\">quoteFile</span><span style=\"color: #24292E\">);</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">        </span><span style=\"color: #D73A49\">if</span><span style=\"color: #24292E\"> quoteText </span><span style=\"color: #D73A49\">is</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">error</span><span style=\"color: #24292E\"> {</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">            log</span><span style=\"color: #D73A49\">:</span><span style=\"color: #6F42C1\">printError</span><span style=\"color: #24292E\">(quoteText.</span><span style=\"color: #6F42C1\">message</span><span style=\"color: #24292E\">());</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">            </span><span style=\"color: #D73A49\">continue</span><span style=\"color: #24292E\">;</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">        }</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">        mREQOTE</span><span style=\"color: #D73A49\">:</span><span style=\"color: #24292E\">EDI_REQOTE_Request_for_quote_message quote </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">check</span><span style=\"color: #24292E\"> mREQOTE</span><span style=\"color: #D73A49\">:</span><span style=\"color: #6F42C1\">fromEdiString</span><span style=\"color: #24292E\">(</span><span style=\"color: #E36209\">quoteText</span><span style=\"color: #24292E\">);</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">        QuoteRequest quoteRequest </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">check</span><span style=\"color: #24292E\"> </span><span style=\"color: #6F42C1\">transformQuoteRequest</span><span style=\"color: #24292E\">(</span><span style=\"color: #E36209\">quote</span><span style=\"color: #24292E\">);</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">        </span><span style=\"color: #005CC5\">string</span><span style=\"color: #D73A49\">|error</span><span style=\"color: #24292E\"> accountId </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #6F42C1\">getSalesforceAccountId</span><span style=\"color: #24292E\">(quoteRequest.accountName);</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">        </span><span style=\"color: #D73A49\">if</span><span style=\"color: #24292E\"> accountId </span><span style=\"color: #D73A49\">is</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">error</span><span style=\"color: #24292E\"> {</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">            log</span><span style=\"color: #D73A49\">:</span><span style=\"color: #6F42C1\">printError</span><span style=\"color: #24292E\">(accountId.</span><span style=\"color: #6F42C1\">message</span><span style=\"color: #24292E\">());</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">            </span><span style=\"color: #D73A49\">continue</span><span style=\"color: #24292E\">;</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">        }</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">        </span><span style=\"color: #005CC5\">string</span><span style=\"color: #24292E\"> oppId </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">check</span><span style=\"color: #24292E\"> </span><span style=\"color: #6F42C1\">getSalesforceOpportunityId</span><span style=\"color: #24292E\">(</span><span style=\"color: #E36209\">accountId</span><span style=\"color: #24292E\">, quoteRequest.oppName);</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">        </span><span style=\"color: #D73A49\">check</span><span style=\"color: #24292E\"> </span><span style=\"color: #6F42C1\">createLineItems</span><span style=\"color: #24292E\">(quoteRequest.itemData, </span><span style=\"color: #E36209\">oppId</span><span style=\"color: #24292E\">);</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">        </span><span style=\"color: #D73A49\">check</span><span style=\"color: #24292E\"> </span><span style=\"color: #6F42C1\">moveProcessedFile</span><span style=\"color: #24292E\">(</span><span style=\"color: #E36209\">quoteFile</span><span style=\"color: #24292E\">, </span><span style=\"color: #E36209\">quoteText</span><span style=\"color: #24292E\">);</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    }</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #D73A49\">function</span><span style=\"color: #24292E\"> </span><span style=\"color: #6F42C1\">getSalesforceAccountId</span><span style=\"color: #24292E\">(</span><span style=\"color: #005CC5\">string</span><span style=\"color: #24292E\"> </span><span style=\"color: #E36209\">accountName</span><span style=\"color: #24292E\">) </span><span style=\"color: #D73A49\">returns</span><span style=\"color: #24292E\"> </span><span style=\"color: #005CC5\">string</span><span style=\"color: #D73A49\">|error</span><span style=\"color: #24292E\"> {</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #D73A49\">stream&lt;</span><span style=\"color: #24292E\">Id, </span><span style=\"color: #D73A49\">error?&gt;</span><span style=\"color: #24292E\"> accQuery </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">check</span><span style=\"color: #24292E\"> salesforce</span><span style=\"color: #D73A49\">-&gt;</span><span style=\"color: #6F42C1\">query</span><span style=\"color: #24292E\">(</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">            </span><span style=\"color: #005CC5\">string</span><span style=\"color: #24292E\"> </span><span style=\"color: #032F62\">`SELECT Id FROM Account WHERE Name = &#39;${</span><span style=\"color: #24292E\">accountName</span><span style=\"color: #032F62\">}&#39;`</span><span style=\"color: #24292E\">);</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #D73A49\">record</span><span style=\"color: #24292E\"> {</span><span style=\"color: #D73A49\">|</span><span style=\"color: #24292E\">Id value;</span><span style=\"color: #D73A49\">|</span><span style=\"color: #24292E\">}</span><span style=\"color: #D73A49\">?</span><span style=\"color: #24292E\"> account </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">check</span><span style=\"color: #24292E\"> accQuery.</span><span style=\"color: #6F42C1\">next</span><span style=\"color: #24292E\">();</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #D73A49\">check</span><span style=\"color: #24292E\"> accQuery.</span><span style=\"color: #6F42C1\">close</span><span style=\"color: #24292E\">();</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #D73A49\">if</span><span style=\"color: #24292E\"> account </span><span style=\"color: #D73A49\">is</span><span style=\"color: #24292E\"> () {</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">        </span><span style=\"color: #D73A49\">return</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">error</span><span style=\"color: #24292E\">(</span><span style=\"color: #032F62\">&quot;Account not found. Account name: &quot;</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">+</span><span style=\"color: #24292E\"> </span><span style=\"color: #E36209\">accountName</span><span style=\"color: #24292E\">);</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    }</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #D73A49\">return</span><span style=\"color: #24292E\"> account.value.Id;</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #D73A49\">function</span><span style=\"color: #24292E\"> </span><span style=\"color: #6F42C1\">getSalesforceOpportunityId</span><span style=\"color: #24292E\">(</span><span style=\"color: #005CC5\">string</span><span style=\"color: #24292E\"> </span><span style=\"color: #E36209\">accountId</span><span style=\"color: #24292E\">, </span><span style=\"color: #005CC5\">string</span><span style=\"color: #24292E\"> </span><span style=\"color: #E36209\">oppName</span><span style=\"color: #24292E\">) </span><span style=\"color: #D73A49\">returns</span><span style=\"color: #24292E\"> </span><span style=\"color: #005CC5\">string</span><span style=\"color: #D73A49\">|error</span><span style=\"color: #24292E\"> {</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #D73A49\">stream&lt;</span><span style=\"color: #24292E\">Id, </span><span style=\"color: #D73A49\">error?&gt;</span><span style=\"color: #24292E\"> oppQuery </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">check</span><span style=\"color: #24292E\"> salesforce</span><span style=\"color: #D73A49\">-&gt;</span><span style=\"color: #6F42C1\">query</span><span style=\"color: #24292E\">(</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">            </span><span style=\"color: #005CC5\">string</span><span style=\"color: #24292E\"> </span><span style=\"color: #032F62\">`SELECT Id FROM Opportunity WHERE Name = &#39;${</span><span style=\"color: #24292E\">oppName</span><span style=\"color: #032F62\">}&#39;`</span><span style=\"color: #24292E\">);</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #D73A49\">record</span><span style=\"color: #24292E\"> {</span><span style=\"color: #D73A49\">|</span><span style=\"color: #24292E\">Id value;</span><span style=\"color: #D73A49\">|</span><span style=\"color: #24292E\">}</span><span style=\"color: #D73A49\">?</span><span style=\"color: #24292E\"> existingOpp </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">check</span><span style=\"color: #24292E\"> oppQuery.</span><span style=\"color: #6F42C1\">next</span><span style=\"color: #24292E\">();</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #D73A49\">check</span><span style=\"color: #24292E\"> oppQuery.</span><span style=\"color: #6F42C1\">close</span><span style=\"color: #24292E\">();</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #D73A49\">if</span><span style=\"color: #24292E\"> existingOpp </span><span style=\"color: #D73A49\">!is</span><span style=\"color: #24292E\"> () {</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">        </span><span style=\"color: #D73A49\">return</span><span style=\"color: #24292E\"> existingOpp.value.Id;</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    }</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    Opportunity opp </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> {</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">        Name</span><span style=\"color: #D73A49\">:</span><span style=\"color: #24292E\"> oppName,</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">        AccountId</span><span style=\"color: #D73A49\">:</span><span style=\"color: #24292E\"> accountId,</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">        Pricebook2Id</span><span style=\"color: #D73A49\">:</span><span style=\"color: #24292E\"> salesforcePriceBookId</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    };</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    sf</span><span style=\"color: #D73A49\">:</span><span style=\"color: #24292E\">CreationResponse oppResult </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">check</span><span style=\"color: #24292E\"> salesforce</span><span style=\"color: #D73A49\">-&gt;</span><span style=\"color: #6F42C1\">create</span><span style=\"color: #24292E\">(</span><span style=\"color: #032F62\">&quot;Opportunity&quot;</span><span style=\"color: #24292E\">, </span><span style=\"color: #E36209\">opp</span><span style=\"color: #24292E\">);</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #D73A49\">return</span><span style=\"color: #24292E\"> oppResult.id;</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #D73A49\">function</span><span style=\"color: #24292E\"> </span><span style=\"color: #6F42C1\">createLineItems</span><span style=\"color: #24292E\">(</span><span style=\"color: #E36209\">ItemData</span><span style=\"color: #24292E\">[] </span><span style=\"color: #E36209\">items</span><span style=\"color: #24292E\">, </span><span style=\"color: #005CC5\">string</span><span style=\"color: #24292E\"> </span><span style=\"color: #E36209\">oppId</span><span style=\"color: #24292E\">) </span><span style=\"color: #D73A49\">returns</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">error?</span><span style=\"color: #24292E\"> {</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #D73A49\">foreach </span><span style=\"color: #24292E\">ItemData item </span><span style=\"color: #D73A49\">in</span><span style=\"color: #24292E\"> items {</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">        </span><span style=\"color: #D73A49\">stream&lt;</span><span style=\"color: #24292E\">PriceBookEntry, </span><span style=\"color: #D73A49\">error?&gt;</span><span style=\"color: #24292E\"> query </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">check</span><span style=\"color: #24292E\"> salesforce</span><span style=\"color: #D73A49\">-&gt;</span><span style=\"color: #6F42C1\">query</span><span style=\"color: #24292E\">(</span><span style=\"color: #005CC5\">string</span><span style=\"color: #24292E\"> </span><span style=\"color: #032F62\">`SELECT UnitPrice FROM PricebookEntry WHERE Pricebook2Id = &#39;01s6C000000UN4PQAW&#39; AND Product2Id = &#39;${</span><span style=\"color: #24292E\">item</span><span style=\"color: #032F62\">.</span><span style=\"color: #24292E\">itemId</span><span style=\"color: #032F62\">}&#39;`</span><span style=\"color: #24292E\">);</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">        </span><span style=\"color: #D73A49\">record</span><span style=\"color: #24292E\"> {</span><span style=\"color: #D73A49\">|</span><span style=\"color: #24292E\">PriceBookEntry value;</span><span style=\"color: #D73A49\">|</span><span style=\"color: #24292E\">}</span><span style=\"color: #D73A49\">?</span><span style=\"color: #24292E\"> unionResult </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">check</span><span style=\"color: #24292E\"> query.</span><span style=\"color: #6F42C1\">next</span><span style=\"color: #24292E\">();</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">        </span><span style=\"color: #D73A49\">check</span><span style=\"color: #24292E\"> query.</span><span style=\"color: #6F42C1\">close</span><span style=\"color: #24292E\">();</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">        </span><span style=\"color: #D73A49\">if</span><span style=\"color: #24292E\"> unionResult </span><span style=\"color: #D73A49\">is</span><span style=\"color: #24292E\"> () {</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">            </span><span style=\"color: #D73A49\">return</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">error</span><span style=\"color: #24292E\">(</span><span style=\"color: #005CC5\">string</span><span style=\"color: #24292E\"> </span><span style=\"color: #032F62\">`Pricebook entry not found. Opportunity: ${</span><span style=\"color: #24292E\">oppId</span><span style=\"color: #032F62\">}, Item ID: ${</span><span style=\"color: #24292E\">item</span><span style=\"color: #032F62\">.</span><span style=\"color: #24292E\">itemId</span><span style=\"color: #032F62\">}`</span><span style=\"color: #24292E\">);</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">        }</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">        OpportunityProduct oppProduct </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> {</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">            OpportunityId</span><span style=\"color: #D73A49\">:</span><span style=\"color: #24292E\"> oppId,</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">            Product2Id</span><span style=\"color: #D73A49\">:</span><span style=\"color: #24292E\"> item.itemId,</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">            Quantity</span><span style=\"color: #D73A49\">:</span><span style=\"color: #24292E\"> item.quantity,</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">            UnitPrice</span><span style=\"color: #D73A49\">:</span><span style=\"color: #24292E\"> unionResult.value.UnitPrice</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">        };</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">        _ </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">check</span><span style=\"color: #24292E\"> salesforce</span><span style=\"color: #D73A49\">-&gt;</span><span style=\"color: #6F42C1\">create</span><span style=\"color: #24292E\">(</span><span style=\"color: #032F62\">&quot;OpportunityLineItem&quot;</span><span style=\"color: #24292E\">, </span><span style=\"color: #E36209\">oppProduct</span><span style=\"color: #24292E\">);</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    }</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #D73A49\">function</span><span style=\"color: #24292E\"> </span><span style=\"color: #6F42C1\">moveProcessedFile</span><span style=\"color: #24292E\">(</span><span style=\"color: #E36209\">ftp</span><span style=\"color: #D73A49\">:</span><span style=\"color: #24292E\">FileInfo quoteFile, </span><span style=\"color: #005CC5\">string</span><span style=\"color: #24292E\"> </span><span style=\"color: #E36209\">quoteText</span><span style=\"color: #24292E\">) </span><span style=\"color: #D73A49\">returns</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">error?</span><span style=\"color: #24292E\"> {</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #D73A49\">check</span><span style=\"color: #24292E\"> fileServer</span><span style=\"color: #D73A49\">-&gt;</span><span style=\"color: #6F42C1\">put</span><span style=\"color: #24292E\">(</span><span style=\"color: #D73A49\">check</span><span style=\"color: #24292E\"> </span><span style=\"color: #E36209\">file</span><span style=\"color: #D73A49\">:</span><span style=\"color: #6F42C1\">joinPath</span><span style=\"color: #24292E\">(</span><span style=\"color: #E36209\">ftpProcessedQuotesPath</span><span style=\"color: #24292E\">, quoteFile.name), quoteText.</span><span style=\"color: #6F42C1\">toBytes</span><span style=\"color: #24292E\">());</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #D73A49\">check</span><span style=\"color: #24292E\"> fileServer</span><span style=\"color: #D73A49\">-&gt;</span><span style=\"color: #6F42C1\">delete</span><span style=\"color: #24292E\">(quoteFile.path);</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #D73A49\">function</span><span style=\"color: #24292E\"> </span><span style=\"color: #6F42C1\">getFileText</span><span style=\"color: #24292E\">(</span><span style=\"color: #E36209\">ftp</span><span style=\"color: #D73A49\">:</span><span style=\"color: #24292E\">FileInfo quoteFile) </span><span style=\"color: #D73A49\">returns</span><span style=\"color: #24292E\"> </span><span style=\"color: #005CC5\">string</span><span style=\"color: #D73A49\">|error</span><span style=\"color: #24292E\"> {</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #D73A49\">if</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">!</span><span style=\"color: #24292E\">quoteFile.name.</span><span style=\"color: #6F42C1\">endsWith</span><span style=\"color: #24292E\">(</span><span style=\"color: #032F62\">&quot;.edi&quot;</span><span style=\"color: #24292E\">) {</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">        </span><span style=\"color: #D73A49\">return</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">error</span><span style=\"color: #24292E\">(</span><span style=\"color: #032F62\">&quot;Invalid file type. File name: &quot;</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">+</span><span style=\"color: #24292E\"> quoteFile.name);</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    }</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #D73A49\">stream&lt;</span><span style=\"color: #005CC5\">byte</span><span style=\"color: #24292E\">[] </span><span style=\"color: #D73A49\">&amp;</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">readonly</span><span style=\"color: #24292E\">, io</span><span style=\"color: #D73A49\">:</span><span style=\"color: #24292E\">Error?</span><span style=\"color: #D73A49\">&gt;</span><span style=\"color: #24292E\"> fileStream </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">check</span><span style=\"color: #24292E\"> fileServer</span><span style=\"color: #D73A49\">-&gt;</span><span style=\"color: #6F42C1\">get</span><span style=\"color: #24292E\">(quoteFile.path);</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #005CC5\">byte</span><span style=\"color: #24292E\">[] content </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> [];</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #D73A49\">check</span><span style=\"color: #24292E\"> fileStream.</span><span style=\"color: #6F42C1\">forEach</span><span style=\"color: #24292E\">(</span><span style=\"color: #D73A49\">function</span><span style=\"color: #24292E\">(</span><span style=\"color: #005CC5\">byte</span><span style=\"color: #24292E\">[] </span><span style=\"color: #D73A49\">&amp;</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">readonly</span><span style=\"color: #24292E\"> </span><span style=\"color: #E36209\">chunk</span><span style=\"color: #24292E\">) {</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">        content.</span><span style=\"color: #6F42C1\">push</span><span style=\"color: #24292E\">(...</span><span style=\"color: #E36209\">chunk</span><span style=\"color: #24292E\">);</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    });</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #D73A49\">return</span><span style=\"color: #24292E\"> </span><span style=\"color: #005CC5\">string</span><span style=\"color: #D73A49\">:</span><span style=\"color: #6F42C1\">fromBytes</span><span style=\"color: #24292E\">(</span><span style=\"color: #E36209\">content</span><span style=\"color: #24292E\">);</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">}</span></span></code></pre>"},"batch-data":{"frontmatter":{"title":"Start Salesforce integrations instantly with Ballerina + Choreo","description":"Choreo provides a comprehensive app development environment with production-ready deployment, CI/CD pipelines, multi-environment support, and robust monitoring for Ballerina apps. Start Salesforce integrations instantly on the cloud with Choreo and continue incrementally to unleash the full power of Salesforce.","url":"https://wso2.com/choreo/internal-developer-platform","image":"images/choreo-ipaas-image-v2.png"},"code":""},"datasources":{"frontmatter":{"title":"Bridge Salesforce with disparate data sources","description":"Data about products, customers, and sales transactions are often scattered across various systems, databases, and business units. Ballerina, with its rich set of connectors and data handling capabilities, can link Salesforce with all relevant data sources.<br/><br/><i>Example: Load product data from a MySQL database to Salesforce.</i>","url":"https://github.com/chathurace/integration-samples/blob/main/salesforce_api/mysql-record-to-sfdc-new-product/main.bal","image":""},"code":"<pre class=\"shiki github-light\" style=\"background-color: #fff\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #24292E\">salesforce</span><span style=\"color: #D73A49\">:</span><span style=\"color: #24292E\">Client salesforce </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">check</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">new</span><span style=\"color: #24292E\"> ({</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    baseUrl</span><span style=\"color: #D73A49\">:</span><span style=\"color: #24292E\"> salesforceBaseUrl,</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    auth</span><span style=\"color: #D73A49\">:</span><span style=\"color: #24292E\"> {</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">        token</span><span style=\"color: #D73A49\">:</span><span style=\"color: #24292E\"> salesforceAccessToken</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    }</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">});</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #D73A49\">public</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">function</span><span style=\"color: #24292E\"> </span><span style=\"color: #6F42C1\">main</span><span style=\"color: #24292E\">() </span><span style=\"color: #D73A49\">returns</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">error?</span><span style=\"color: #24292E\"> {</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    mysql</span><span style=\"color: #D73A49\">:</span><span style=\"color: #24292E\">Client mysql </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">check</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">new</span><span style=\"color: #24292E\"> (</span><span style=\"color: #E36209\">host</span><span style=\"color: #24292E\">, </span><span style=\"color: #E36209\">user</span><span style=\"color: #24292E\">, </span><span style=\"color: #E36209\">password</span><span style=\"color: #24292E\">, </span><span style=\"color: #E36209\">database</span><span style=\"color: #24292E\">, </span><span style=\"color: #E36209\">port</span><span style=\"color: #24292E\">);</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #D73A49\">stream&lt;</span><span style=\"color: #24292E\">ProductRecieved, </span><span style=\"color: #D73A49\">error?&gt;</span><span style=\"color: #24292E\"> streamOutput </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> mysql</span><span style=\"color: #D73A49\">-&gt;</span><span style=\"color: #6F42C1\">query</span><span style=\"color: #24292E\">(</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">        </span><span style=\"color: #032F62\">`SELECT name, unitType, currencyISO, productId FROM products WHERE processed = false`</span><span style=\"color: #24292E\">);</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    ProductRecieved[] productsRecieved </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">check</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">from</span><span style=\"color: #24292E\"> ProductRecieved items </span><span style=\"color: #D73A49\">in</span><span style=\"color: #24292E\"> streamOutput</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">        </span><span style=\"color: #D73A49\">select</span><span style=\"color: #24292E\"> items;</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #D73A49\">foreach </span><span style=\"color: #24292E\">ProductRecieved prductRecieved </span><span style=\"color: #D73A49\">in</span><span style=\"color: #24292E\"> productsRecieved {</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">        Product product </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> {</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">            Name</span><span style=\"color: #D73A49\">:</span><span style=\"color: #24292E\"> prductRecieved.name,</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">            Product_Unit__c</span><span style=\"color: #D73A49\">:</span><span style=\"color: #24292E\"> prductRecieved.unitType,</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">            CurrencyIsoCode</span><span style=\"color: #D73A49\">:</span><span style=\"color: #24292E\"> prductRecieved.currencyISO</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">        };</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">        _ </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">check</span><span style=\"color: #24292E\"> salesforce</span><span style=\"color: #D73A49\">-&gt;</span><span style=\"color: #6F42C1\">create</span><span style=\"color: #24292E\">(</span><span style=\"color: #032F62\">&quot;Product2&quot;</span><span style=\"color: #24292E\">, </span><span style=\"color: #E36209\">product</span><span style=\"color: #24292E\">);</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">        _ </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">check</span><span style=\"color: #24292E\"> mysql</span><span style=\"color: #D73A49\">-&gt;</span><span style=\"color: #6F42C1\">execute</span><span style=\"color: #24292E\">(</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">            </span><span style=\"color: #032F62\">`UPDATE products SET processed = true WHERE productId = ${</span><span style=\"color: #24292E\">prductRecieved</span><span style=\"color: #032F62\">.</span><span style=\"color: #24292E\">productId</span><span style=\"color: #032F62\">}`</span><span style=\"color: #24292E\">);</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    }</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">}</span></span></code></pre>"},"notifications":{"frontmatter":{"title":"Act on Salesforce based notifications","description":"Sales related events need to be acted upon as soon as possible. For example, when a new lead is received, sales staff need to evaluate it and get in contact with the lead immediately. Ballerina can listen for any event in Salesforce and notify relevant employees over their preferred channels, ensuring that all customer events are attended in a timely manner.<br/><br/><i>Example: Send an SMS to a given number (via Twilio) when a new lead is created in Salesforce.</i>","url":"https://github.com/chathurace/integration-samples/blob/main/salesforce_api/sfdc-new-contact-to-twilio-sms/main.bal","image":""},"code":"<pre class=\"shiki github-light\" style=\"background-color: #fff\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #D73A49\">listener</span><span style=\"color: #24292E\"> salesforce</span><span style=\"color: #D73A49\">:</span><span style=\"color: #24292E\">Listener sfdcEventListener </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">new</span><span style=\"color: #24292E\"> ({</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    username</span><span style=\"color: #D73A49\">:</span><span style=\"color: #24292E\"> salesforceListenerConfig.username,</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    password</span><span style=\"color: #D73A49\">:</span><span style=\"color: #24292E\"> salesforceListenerConfig.password,</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    channelName</span><span style=\"color: #D73A49\">:</span><span style=\"color: #24292E\"> CHANNEL_NAME</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">});</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #D73A49\">final</span><span style=\"color: #24292E\"> twilio</span><span style=\"color: #D73A49\">:</span><span style=\"color: #24292E\">Client twilio </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">check</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">new</span><span style=\"color: #24292E\"> ({</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    twilioAuth</span><span style=\"color: #D73A49\">:</span><span style=\"color: #24292E\"> {</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">        accountSId</span><span style=\"color: #D73A49\">:</span><span style=\"color: #24292E\"> twilioClientConfig.accountSId,</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">        authToken</span><span style=\"color: #D73A49\">:</span><span style=\"color: #24292E\"> twilioClientConfig.authToken</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    }</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">});</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #D73A49\">service</span><span style=\"color: #24292E\"> salesforce:RecordService </span><span style=\"color: #D73A49\">on</span><span style=\"color: #24292E\"> sfdcEventListener {</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #D73A49\">isolated</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">remote</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">function</span><span style=\"color: #24292E\"> </span><span style=\"color: #6F42C1\">onCreate</span><span style=\"color: #24292E\">(</span><span style=\"color: #E36209\">salesforce</span><span style=\"color: #D73A49\">:</span><span style=\"color: #24292E\">EventData payload) </span><span style=\"color: #D73A49\">returns</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">error?</span><span style=\"color: #24292E\"> {</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">        </span><span style=\"color: #005CC5\">string</span><span style=\"color: #24292E\"> firstName </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #032F62\">&quot;&quot;</span><span style=\"color: #24292E\">;</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">        </span><span style=\"color: #005CC5\">string</span><span style=\"color: #24292E\"> lastName </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #032F62\">&quot;&quot;</span><span style=\"color: #24292E\">;</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">        </span><span style=\"color: #005CC5\">string</span><span style=\"color: #24292E\">[] nameParts </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> re </span><span style=\"color: #032F62\">`,`</span><span style=\"color: #24292E\">.</span><span style=\"color: #6F42C1\">split</span><span style=\"color: #24292E\">(payload.changedData[</span><span style=\"color: #032F62\">&quot;Name&quot;</span><span style=\"color: #24292E\">].</span><span style=\"color: #6F42C1\">toString</span><span style=\"color: #24292E\">());</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">        </span><span style=\"color: #D73A49\">if</span><span style=\"color: #24292E\"> nameParts.</span><span style=\"color: #6F42C1\">length</span><span style=\"color: #24292E\">() </span><span style=\"color: #D73A49\">&gt;=</span><span style=\"color: #24292E\"> </span><span style=\"color: #005CC5\">2</span><span style=\"color: #24292E\"> {</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">            firstName </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> re </span><span style=\"color: #032F62\">`=`</span><span style=\"color: #24292E\">.</span><span style=\"color: #6F42C1\">split</span><span style=\"color: #24292E\">(</span><span style=\"color: #E36209\">nameParts</span><span style=\"color: #24292E\">[</span><span style=\"color: #005CC5\">0</span><span style=\"color: #24292E\">])[</span><span style=\"color: #005CC5\">1</span><span style=\"color: #24292E\">];</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">            lastName </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> re </span><span style=\"color: #032F62\">`=`</span><span style=\"color: #24292E\">.</span><span style=\"color: #6F42C1\">split</span><span style=\"color: #24292E\">(</span><span style=\"color: #E36209\">re</span><span style=\"color: #24292E\"> </span><span style=\"color: #032F62\">`</span><span style=\"color: #005CC5\">\\}</span><span style=\"color: #032F62\">`</span><span style=\"color: #24292E\">.</span><span style=\"color: #6F42C1\">replace</span><span style=\"color: #24292E\">(</span><span style=\"color: #E36209\">nameParts</span><span style=\"color: #24292E\">[</span><span style=\"color: #005CC5\">1</span><span style=\"color: #24292E\">], </span><span style=\"color: #032F62\">&quot;&quot;</span><span style=\"color: #24292E\">))[</span><span style=\"color: #005CC5\">1</span><span style=\"color: #24292E\">];</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">        } </span><span style=\"color: #D73A49\">else</span><span style=\"color: #24292E\"> {</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">            lastName </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> re </span><span style=\"color: #032F62\">`=`</span><span style=\"color: #24292E\">.</span><span style=\"color: #6F42C1\">split</span><span style=\"color: #24292E\">(</span><span style=\"color: #E36209\">re</span><span style=\"color: #24292E\"> </span><span style=\"color: #032F62\">`</span><span style=\"color: #005CC5\">\\}</span><span style=\"color: #032F62\">`</span><span style=\"color: #24292E\">.</span><span style=\"color: #6F42C1\">replace</span><span style=\"color: #24292E\">(</span><span style=\"color: #E36209\">nameParts</span><span style=\"color: #24292E\">[</span><span style=\"color: #005CC5\">0</span><span style=\"color: #24292E\">], </span><span style=\"color: #032F62\">&quot;&quot;</span><span style=\"color: #24292E\">))[</span><span style=\"color: #005CC5\">1</span><span style=\"color: #24292E\">];</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">        }</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">        twilio</span><span style=\"color: #D73A49\">:</span><span style=\"color: #24292E\">SmsResponse response </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">check</span><span style=\"color: #24292E\"> twilio</span><span style=\"color: #D73A49\">-&gt;</span><span style=\"color: #6F42C1\">sendSms</span><span style=\"color: #24292E\">(</span><span style=\"color: #E36209\">fromNumber</span><span style=\"color: #24292E\">, </span><span style=\"color: #E36209\">toNumber</span><span style=\"color: #24292E\">,</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">            </span><span style=\"color: #005CC5\">string</span><span style=\"color: #24292E\"> </span><span style=\"color: #032F62\">`New contact is created! | Name: ${</span><span style=\"color: #24292E\">firstName</span><span style=\"color: #032F62\">} ${</span><span style=\"color: #24292E\">lastName</span><span style=\"color: #032F62\">} | Created Date: </span></span>\n<span class=\"line\"><span style=\"color: #032F62\">            ${</span><span style=\"color: #032F62\">(</span><span style=\"color: #D73A49\">check</span><span style=\"color: #032F62\"> </span><span style=\"color: #24292E\">payload</span><span style=\"color: #032F62\">.</span><span style=\"color: #24292E\">changedData</span><span style=\"color: #032F62\">.</span><span style=\"color: #24292E\">CreatedDate</span><span style=\"color: #032F62\">).</span><span style=\"color: #6F42C1\">toString</span><span style=\"color: #032F62\">()</span><span style=\"color: #032F62\">}`</span><span style=\"color: #24292E\">);</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">        log</span><span style=\"color: #D73A49\">:</span><span style=\"color: #6F42C1\">printInfo</span><span style=\"color: #24292E\">(</span><span style=\"color: #032F62\">&quot;SMS(SID: &quot;</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">+</span><span style=\"color: #24292E\"> response.sid </span><span style=\"color: #D73A49\">+</span><span style=\"color: #24292E\"> </span><span style=\"color: #032F62\">&quot;) sent successfully&quot;</span><span style=\"color: #24292E\">);</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    }</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #D73A49\">isolated</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">remote</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">function</span><span style=\"color: #24292E\"> </span><span style=\"color: #6F42C1\">onUpdate</span><span style=\"color: #24292E\">(</span><span style=\"color: #E36209\">salesforce</span><span style=\"color: #D73A49\">:</span><span style=\"color: #24292E\">EventData payload) </span><span style=\"color: #D73A49\">returns</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">error?</span><span style=\"color: #24292E\"> {</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">        </span><span style=\"color: #D73A49\">return</span><span style=\"color: #24292E\">;</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    }</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #D73A49\">isolated</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">remote</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">function</span><span style=\"color: #24292E\"> </span><span style=\"color: #6F42C1\">onDelete</span><span style=\"color: #24292E\">(</span><span style=\"color: #E36209\">salesforce</span><span style=\"color: #D73A49\">:</span><span style=\"color: #24292E\">EventData payload) </span><span style=\"color: #D73A49\">returns</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">error?</span><span style=\"color: #24292E\"> {</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">        </span><span style=\"color: #D73A49\">return</span><span style=\"color: #24292E\">;</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    }</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #D73A49\">isolated</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">remote</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">function</span><span style=\"color: #24292E\"> </span><span style=\"color: #6F42C1\">onRestore</span><span style=\"color: #24292E\">(</span><span style=\"color: #E36209\">salesforce</span><span style=\"color: #D73A49\">:</span><span style=\"color: #24292E\">EventData payload) </span><span style=\"color: #D73A49\">returns</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">error?</span><span style=\"color: #24292E\"> {</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">        </span><span style=\"color: #D73A49\">return</span><span style=\"color: #24292E\">;</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    }</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">}</span></span></code></pre>"},"productivity":{"frontmatter":{"title":"Connect Salesforce with productivity tools","description":"Sales and customer data are often captured via office productivity tools such as Google Docs, Sheets, and Slack. Ballerina can pump data from such office tools into Salesforce by performing validation and cleansing where necessary to standardize manually entered data.<br/><br/><i>Example: Create contacts in Salesforce by reading contact details given in a Google Sheet.</i>","url":"https://github.com/chathurace/integration-samples/blob/main/salesforce_api/gsheet-new-row-to-sfdc-new-contact/main.bal","image":""},"code":"<pre class=\"shiki github-light\" style=\"background-color: #fff\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #24292E\">sheets</span><span style=\"color: #D73A49\">:</span><span style=\"color: #24292E\">Client sheets </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">check</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">new</span><span style=\"color: #24292E\"> ({auth</span><span style=\"color: #D73A49\">:</span><span style=\"color: #24292E\"> {token: sheetsAccessToken}});</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #24292E\">salesforce</span><span style=\"color: #D73A49\">:</span><span style=\"color: #24292E\">Client salesforce </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">check</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">new</span><span style=\"color: #24292E\"> ({</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    baseUrl</span><span style=\"color: #D73A49\">:</span><span style=\"color: #24292E\"> salesforceBaseUrl,</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    auth</span><span style=\"color: #D73A49\">:</span><span style=\"color: #24292E\"> {</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">        token</span><span style=\"color: #D73A49\">:</span><span style=\"color: #24292E\"> salesforceAccessToken</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    }</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">});</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #D73A49\">public</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">function</span><span style=\"color: #24292E\"> </span><span style=\"color: #6F42C1\">main</span><span style=\"color: #24292E\">() </span><span style=\"color: #D73A49\">returns</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">error?</span><span style=\"color: #24292E\"> {</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    sheets</span><span style=\"color: #D73A49\">:</span><span style=\"color: #24292E\">Range range </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">check</span><span style=\"color: #24292E\"> sheets</span><span style=\"color: #D73A49\">-&gt;</span><span style=\"color: #6F42C1\">getRange</span><span style=\"color: #24292E\">(</span><span style=\"color: #E36209\">spreadsheetId</span><span style=\"color: #24292E\">, </span><span style=\"color: #E36209\">worksheetName</span><span style=\"color: #24292E\">, </span><span style=\"color: #032F62\">&quot;A1:G&quot;</span><span style=\"color: #24292E\">);</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    (</span><span style=\"color: #005CC5\">int</span><span style=\"color: #D73A49\">|</span><span style=\"color: #005CC5\">string</span><span style=\"color: #D73A49\">|</span><span style=\"color: #005CC5\">decimal</span><span style=\"color: #24292E\">)[] headers </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> range.values[</span><span style=\"color: #005CC5\">0</span><span style=\"color: #24292E\">];</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #D73A49\">foreach </span><span style=\"color: #24292E\">(</span><span style=\"color: #005CC5\">int</span><span style=\"color: #D73A49\">|</span><span style=\"color: #005CC5\">string</span><span style=\"color: #D73A49\">|</span><span style=\"color: #005CC5\">decimal</span><span style=\"color: #24292E\">)[] item </span><span style=\"color: #D73A49\">in</span><span style=\"color: #24292E\"> range.values.</span><span style=\"color: #6F42C1\">slice</span><span style=\"color: #24292E\">(</span><span style=\"color: #E36209\">HEADINGS_ROW</span><span style=\"color: #24292E\">) {</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">        </span><span style=\"color: #005CC5\">int</span><span style=\"color: #24292E\">? indexOfEmail </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> headers.</span><span style=\"color: #6F42C1\">indexOf</span><span style=\"color: #24292E\">(</span><span style=\"color: #032F62\">&quot;Email&quot;</span><span style=\"color: #24292E\">);</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">        </span><span style=\"color: #D73A49\">if</span><span style=\"color: #24292E\"> indexOfEmail </span><span style=\"color: #D73A49\">is</span><span style=\"color: #24292E\"> () {</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">            </span><span style=\"color: #D73A49\">return</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">error</span><span style=\"color: #24292E\">(</span><span style=\"color: #032F62\">&quot;Email column not found&quot;</span><span style=\"color: #24292E\">);</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">        }</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">        </span><span style=\"color: #D73A49\">stream&lt;</span><span style=\"color: #24292E\">Contact, </span><span style=\"color: #D73A49\">error?&gt;</span><span style=\"color: #24292E\"> retrievedStream </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">check</span><span style=\"color: #24292E\"> salesforce</span><span style=\"color: #D73A49\">-&gt;</span><span style=\"color: #6F42C1\">query</span><span style=\"color: #24292E\">(</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">            </span><span style=\"color: #005CC5\">string</span><span style=\"color: #24292E\"> </span><span style=\"color: #032F62\">`SELECT Id, Email FROM Contact WHERE Email=&#39;${</span><span style=\"color: #24292E\">item</span><span style=\"color: #032F62\">[</span><span style=\"color: #24292E\">indexOfEmail</span><span style=\"color: #032F62\">]</span><span style=\"color: #032F62\">}&#39;`</span><span style=\"color: #24292E\">);</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">        </span><span style=\"color: #D73A49\">if</span><span style=\"color: #24292E\"> retrievedStream.</span><span style=\"color: #6F42C1\">next</span><span style=\"color: #24292E\">() </span><span style=\"color: #D73A49\">!is</span><span style=\"color: #24292E\"> () {</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">            log</span><span style=\"color: #D73A49\">:</span><span style=\"color: #6F42C1\">printInfo</span><span style=\"color: #24292E\">(</span><span style=\"color: #005CC5\">string</span><span style=\"color: #24292E\"> </span><span style=\"color: #032F62\">`Contact already exists. Email : ${</span><span style=\"color: #24292E\">item</span><span style=\"color: #032F62\">[</span><span style=\"color: #24292E\">indexOfEmail</span><span style=\"color: #032F62\">]</span><span style=\"color: #032F62\">}`</span><span style=\"color: #24292E\">);</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">            _ </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">check</span><span style=\"color: #24292E\"> sheets</span><span style=\"color: #D73A49\">-&gt;</span><span style=\"color: #6F42C1\">appendValue</span><span style=\"color: #24292E\">(</span><span style=\"color: #E36209\">spreadsheetId</span><span style=\"color: #24292E\">, </span><span style=\"color: #E36209\">item</span><span style=\"color: #24292E\">, {sheetName</span><span style=\"color: #D73A49\">:</span><span style=\"color: #24292E\"> duplicateWorksheetName});</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">            </span><span style=\"color: #D73A49\">continue</span><span style=\"color: #24292E\">;</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">        }</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">        </span><span style=\"color: #D73A49\">record</span><span style=\"color: #24292E\"> {} newContact </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">map</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">from</span><span style=\"color: #24292E\"> </span><span style=\"color: #005CC5\">int</span><span style=\"color: #24292E\"> index </span><span style=\"color: #D73A49\">in</span><span style=\"color: #24292E\"> </span><span style=\"color: #005CC5\">0</span><span style=\"color: #24292E\"> ..</span><span style=\"color: #D73A49\">&lt;</span><span style=\"color: #24292E\"> headers.</span><span style=\"color: #6F42C1\">length</span><span style=\"color: #24292E\">()</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">            </span><span style=\"color: #D73A49\">let</span><span style=\"color: #24292E\"> </span><span style=\"color: #005CC5\">int</span><span style=\"color: #D73A49\">|</span><span style=\"color: #005CC5\">string</span><span style=\"color: #D73A49\">|</span><span style=\"color: #005CC5\">decimal</span><span style=\"color: #24292E\"> header </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> headers[index]</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">            </span><span style=\"color: #D73A49\">select</span><span style=\"color: #24292E\"> [header.</span><span style=\"color: #6F42C1\">toString</span><span style=\"color: #24292E\">(), item[index]];</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">        _ </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">check</span><span style=\"color: #24292E\"> salesforce</span><span style=\"color: #D73A49\">-&gt;</span><span style=\"color: #6F42C1\">create</span><span style=\"color: #24292E\">(</span><span style=\"color: #032F62\">&quot;Contact&quot;</span><span style=\"color: #24292E\">, </span><span style=\"color: #E36209\">newContact</span><span style=\"color: #24292E\">);</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">        log</span><span style=\"color: #D73A49\">:</span><span style=\"color: #6F42C1\">printInfo</span><span style=\"color: #24292E\">(</span><span style=\"color: #005CC5\">string</span><span style=\"color: #24292E\"> </span><span style=\"color: #032F62\">`Contact created successfully!. Email : ${</span><span style=\"color: #24292E\">item</span><span style=\"color: #032F62\">[</span><span style=\"color: #24292E\">indexOfEmail</span><span style=\"color: #032F62\">]</span><span style=\"color: #032F62\">}`</span><span style=\"color: #24292E\">);</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    }</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">}</span></span></code></pre>"},"realtime":{"frontmatter":{"title":"Synchronize Salesforce with real-time data","description":"Information such as inventory levels, order statuses, or product prices change constantly. Ballerina, with its large set of connectors and streaming capabilities, can keep Salesforce in sync with such real-time data sources.<br/><br/><i>Example: Update Salesforce price books by listening to price details published to a Kafka topic.</i>","url":"https://github.com/chathurace/integration-samples/blob/main/salesforce_api/kafka_salesforce_integration/kafka-salesforce-pricebook_update/main.bal","image":""},"code":"<pre class=\"shiki github-light\" style=\"background-color: #fff\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #D73A49\">listener</span><span style=\"color: #24292E\"> kafka</span><span style=\"color: #D73A49\">:</span><span style=\"color: #24292E\">Listener orderListener </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">new</span><span style=\"color: #24292E\"> (</span><span style=\"color: #E36209\">kafka</span><span style=\"color: #D73A49\">:</span><span style=\"color: #24292E\">DEFAULT_URL, {</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    groupId</span><span style=\"color: #D73A49\">:</span><span style=\"color: #24292E\"> </span><span style=\"color: #032F62\">&quot;order-group-id&quot;</span><span style=\"color: #24292E\">,</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    topics</span><span style=\"color: #D73A49\">:</span><span style=\"color: #24292E\"> </span><span style=\"color: #032F62\">&quot;product_price_updates&quot;</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">});</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #D73A49\">final</span><span style=\"color: #24292E\"> salesforce</span><span style=\"color: #D73A49\">:</span><span style=\"color: #24292E\">Client salesforce </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">check</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">new</span><span style=\"color: #24292E\"> ({</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    baseUrl</span><span style=\"color: #D73A49\">:</span><span style=\"color: #24292E\"> salesforceBaseUrl,</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    auth</span><span style=\"color: #D73A49\">:</span><span style=\"color: #24292E\"> {</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">        token</span><span style=\"color: #D73A49\">:</span><span style=\"color: #24292E\"> salesforceAccessToken</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    }</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">});</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #D73A49\">service</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">on</span><span style=\"color: #24292E\"> orderListener {</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #D73A49\">isolated</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">remote</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">function</span><span style=\"color: #24292E\"> </span><span style=\"color: #6F42C1\">onConsumerRecord</span><span style=\"color: #24292E\">(</span><span style=\"color: #E36209\">ProductPrice</span><span style=\"color: #24292E\">[] </span><span style=\"color: #E36209\">prices</span><span style=\"color: #24292E\">) </span><span style=\"color: #D73A49\">returns</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">error?</span><span style=\"color: #24292E\"> {</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">        </span><span style=\"color: #D73A49\">foreach </span><span style=\"color: #24292E\">ProductPrice {name, unitPrice} </span><span style=\"color: #D73A49\">in</span><span style=\"color: #24292E\"> prices {</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">            </span><span style=\"color: #D73A49\">stream&lt;record</span><span style=\"color: #24292E\"> {}, </span><span style=\"color: #D73A49\">error?&gt;</span><span style=\"color: #24292E\"> retrievedStream </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">check</span><span style=\"color: #24292E\"> salesforce</span><span style=\"color: #D73A49\">-&gt;</span><span style=\"color: #6F42C1\">query</span><span style=\"color: #24292E\">(</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">                </span><span style=\"color: #005CC5\">string</span><span style=\"color: #24292E\"> </span><span style=\"color: #032F62\">`SELECT Id FROM PricebookEntry </span></span>\n<span class=\"line\"><span style=\"color: #032F62\">                    WHERE Pricebook2Id = &#39;${</span><span style=\"color: #24292E\">salesforcePriceBookId</span><span style=\"color: #032F62\">}&#39; AND </span></span>\n<span class=\"line\"><span style=\"color: #032F62\">                    Name = &#39;${</span><span style=\"color: #24292E\">name</span><span style=\"color: #032F62\">}&#39;`</span><span style=\"color: #24292E\">);</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">            </span><span style=\"color: #D73A49\">record</span><span style=\"color: #24292E\"> {}[] retrieved </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">check</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">from</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">record</span><span style=\"color: #24292E\"> {} entry </span><span style=\"color: #D73A49\">in</span><span style=\"color: #24292E\"> retrievedStream</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">                </span><span style=\"color: #D73A49\">select</span><span style=\"color: #24292E\"> entry;</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">            </span><span style=\"color: #005CC5\">anydata</span><span style=\"color: #24292E\"> pricebookEntryId </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> retrieved[</span><span style=\"color: #005CC5\">0</span><span style=\"color: #24292E\">][</span><span style=\"color: #032F62\">&quot;Id&quot;</span><span style=\"color: #24292E\">];</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">            </span><span style=\"color: #D73A49\">if</span><span style=\"color: #24292E\"> pricebookEntryId </span><span style=\"color: #D73A49\">is</span><span style=\"color: #24292E\"> </span><span style=\"color: #005CC5\">string</span><span style=\"color: #24292E\"> {</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">                ProductPriceUpdate updatedPrice </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> {UnitPrice</span><span style=\"color: #D73A49\">:</span><span style=\"color: #24292E\"> unitPrice};</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">                </span><span style=\"color: #D73A49\">check</span><span style=\"color: #24292E\"> salesforce</span><span style=\"color: #D73A49\">-&gt;</span><span style=\"color: #6F42C1\">update</span><span style=\"color: #24292E\">(</span><span style=\"color: #032F62\">&quot;PricebookEntry&quot;</span><span style=\"color: #24292E\">, </span><span style=\"color: #E36209\">pricebookEntryId</span><span style=\"color: #24292E\">, </span><span style=\"color: #E36209\">updatedPrice</span><span style=\"color: #24292E\">);</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">            }</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">        }</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    }</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">}</span></span></code></pre>"},"servicenow":{"frontmatter":{"title":"Make sales staff aware of customer issues","description":"Customer issues are tracked in support systems such as JIRA or ServiceNow. However, sales staff also need to be informed about the issues faced by their customers. This synchronization can be done with Ballerina using a few simple steps.<br/><br/><i>Example: Import support cases from ServiceNow to Salesforce for a given time period.</i>","url":"https://github.com/chathurace/integration-samples/blob/main/servicenow-case-to-salesforce-case/main.bal","image":""},"code":"<pre class=\"shiki github-light\" style=\"background-color: #fff\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #D73A49\">public</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">function</span><span style=\"color: #24292E\"> </span><span style=\"color: #6F42C1\">main</span><span style=\"color: #24292E\">() </span><span style=\"color: #D73A49\">returns</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">error?</span><span style=\"color: #24292E\"> {</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    DateRange</span><span style=\"color: #D73A49\">|error</span><span style=\"color: #24292E\"> fetchPeriod </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #6F42C1\">calculateFetchingPeriod</span><span style=\"color: #24292E\">();</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #D73A49\">if</span><span style=\"color: #24292E\"> fetchPeriod </span><span style=\"color: #D73A49\">is</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">error</span><span style=\"color: #24292E\"> {</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">        log</span><span style=\"color: #D73A49\">:</span><span style=\"color: #6F42C1\">printError</span><span style=\"color: #24292E\">(</span><span style=\"color: #032F62\">&quot;Error while calculating fetching period: &quot;</span><span style=\"color: #24292E\">, </span><span style=\"color: #E36209\">fetchPeriod</span><span style=\"color: #24292E\">);</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">        </span><span style=\"color: #D73A49\">return</span><span style=\"color: #24292E\">;</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    }</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #24292E\">    CaseData[]</span><span style=\"color: #D73A49\">|error</span><span style=\"color: #24292E\"> cases </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #6F42C1\">fetchCasesFromServiceNow</span><span style=\"color: #24292E\">(fetchPeriod.&#39;start, fetchPeriod.end);</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #D73A49\">if</span><span style=\"color: #24292E\"> cases </span><span style=\"color: #D73A49\">is</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">error</span><span style=\"color: #24292E\"> {</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">        log</span><span style=\"color: #D73A49\">:</span><span style=\"color: #6F42C1\">printError</span><span style=\"color: #24292E\">(</span><span style=\"color: #032F62\">&quot;Error while fetching cases from ServiceNow: &quot;</span><span style=\"color: #24292E\">, </span><span style=\"color: #E36209\">cases</span><span style=\"color: #24292E\">);</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">        </span><span style=\"color: #D73A49\">return</span><span style=\"color: #24292E\">;</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    }</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #D73A49\">error?</span><span style=\"color: #24292E\"> e </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #6F42C1\">addCasesToSalesforce</span><span style=\"color: #24292E\">(</span><span style=\"color: #E36209\">cases</span><span style=\"color: #24292E\">);</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #D73A49\">if</span><span style=\"color: #24292E\"> e </span><span style=\"color: #D73A49\">is</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">error</span><span style=\"color: #24292E\"> {</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">        log</span><span style=\"color: #D73A49\">:</span><span style=\"color: #6F42C1\">printError</span><span style=\"color: #24292E\">(</span><span style=\"color: #032F62\">&quot;Error while adding cases to Salesforce: &quot;</span><span style=\"color: #24292E\">, </span><span style=\"color: #E36209\">e</span><span style=\"color: #24292E\">);</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">        </span><span style=\"color: #D73A49\">return</span><span style=\"color: #24292E\">;</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    }</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #D73A49\">check</span><span style=\"color: #24292E\"> io</span><span style=\"color: #D73A49\">:</span><span style=\"color: #6F42C1\">fileWriteString</span><span style=\"color: #24292E\">(</span><span style=\"color: #E36209\">syncData</span><span style=\"color: #24292E\">,</span><span style=\"color: #D73A49\"> check</span><span style=\"color: #24292E\"> </span><span style=\"color: #E36209\">time</span><span style=\"color: #D73A49\">:</span><span style=\"color: #6F42C1\">civilToString</span><span style=\"color: #24292E\">(fetchPeriod.now));</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    log</span><span style=\"color: #D73A49\">:</span><span style=\"color: #6F42C1\">printInfo</span><span style=\"color: #24292E\">(</span><span style=\"color: #032F62\">&quot;Updated salesforce with cases from servicenow.&quot;</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">+</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">        </span><span style=\"color: #032F62\">&quot; Cases added: &quot;</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">+</span><span style=\"color: #24292E\"> cases.</span><span style=\"color: #6F42C1\">length</span><span style=\"color: #24292E\">().</span><span style=\"color: #6F42C1\">toString</span><span style=\"color: #24292E\">() </span><span style=\"color: #D73A49\">+</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">        </span><span style=\"color: #032F62\">&quot; Update Timestamp: &quot;</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">+ check</span><span style=\"color: #24292E\"> </span><span style=\"color: #E36209\">time</span><span style=\"color: #D73A49\">:</span><span style=\"color: #6F42C1\">civilToString</span><span style=\"color: #24292E\">(fetchPeriod.now));</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #D73A49\">function</span><span style=\"color: #24292E\"> </span><span style=\"color: #6F42C1\">calculateFetchingPeriod</span><span style=\"color: #24292E\">() </span><span style=\"color: #D73A49\">returns</span><span style=\"color: #24292E\"> DateRange</span><span style=\"color: #D73A49\">|error</span><span style=\"color: #24292E\"> {</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #005CC5\">string</span><span style=\"color: #24292E\"> lastFetchString </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">check</span><span style=\"color: #24292E\"> io</span><span style=\"color: #D73A49\">:</span><span style=\"color: #6F42C1\">fileReadString</span><span style=\"color: #24292E\">(</span><span style=\"color: #E36209\">syncData</span><span style=\"color: #24292E\">);</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    time</span><span style=\"color: #D73A49\">:</span><span style=\"color: #24292E\">Civil lastFetch </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">check</span><span style=\"color: #24292E\"> time</span><span style=\"color: #D73A49\">:</span><span style=\"color: #6F42C1\">civilFromString</span><span style=\"color: #24292E\">(</span><span style=\"color: #E36209\">lastFetchString</span><span style=\"color: #24292E\">);</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #005CC5\">string</span><span style=\"color: #24292E\"> &#39;start </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #005CC5\">string</span><span style=\"color: #24292E\"> </span><span style=\"color: #032F62\">`&#39;${</span><span style=\"color: #24292E\">lastFetch</span><span style=\"color: #032F62\">.</span><span style=\"color: #24292E\">year</span><span style=\"color: #032F62\">}-${</span><span style=\"color: #24292E\">lastFetch</span><span style=\"color: #032F62\">.</span><span style=\"color: #24292E\">month</span><span style=\"color: #032F62\">}-${</span><span style=\"color: #24292E\">lastFetch</span><span style=\"color: #032F62\">.</span><span style=\"color: #24292E\">day</span><span style=\"color: #032F62\">}&#39;,&#39;${</span><span style=\"color: #24292E\">lastFetch</span><span style=\"color: #032F62\">.</span><span style=\"color: #24292E\">hour</span><span style=\"color: #032F62\">}:${</span><span style=\"color: #24292E\">lastFetch</span><span style=\"color: #032F62\">.</span><span style=\"color: #24292E\">minute</span><span style=\"color: #032F62\">}:00&#39;`</span><span style=\"color: #24292E\">;</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    time</span><span style=\"color: #D73A49\">:</span><span style=\"color: #24292E\">Civil now </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> time</span><span style=\"color: #D73A49\">:</span><span style=\"color: #6F42C1\">utcToCivil</span><span style=\"color: #24292E\">(</span><span style=\"color: #E36209\">time</span><span style=\"color: #D73A49\">:</span><span style=\"color: #6F42C1\">utcNow</span><span style=\"color: #24292E\">());</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #005CC5\">string</span><span style=\"color: #24292E\"> end </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #005CC5\">string</span><span style=\"color: #24292E\"> </span><span style=\"color: #032F62\">`&#39;${</span><span style=\"color: #24292E\">now</span><span style=\"color: #032F62\">.</span><span style=\"color: #24292E\">year</span><span style=\"color: #032F62\">}-${</span><span style=\"color: #24292E\">now</span><span style=\"color: #032F62\">.</span><span style=\"color: #24292E\">month</span><span style=\"color: #032F62\">}-${</span><span style=\"color: #24292E\">now</span><span style=\"color: #032F62\">.</span><span style=\"color: #24292E\">day</span><span style=\"color: #032F62\">}&#39;,&#39;${</span><span style=\"color: #24292E\">now</span><span style=\"color: #032F62\">.</span><span style=\"color: #24292E\">hour</span><span style=\"color: #032F62\">}:${</span><span style=\"color: #24292E\">now</span><span style=\"color: #032F62\">.</span><span style=\"color: #24292E\">minute</span><span style=\"color: #032F62\">}:00&#39;`</span><span style=\"color: #24292E\">;</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #D73A49\">return</span><span style=\"color: #24292E\"> {&#39;start, end, now};</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #D73A49\">function</span><span style=\"color: #24292E\"> </span><span style=\"color: #6F42C1\">fetchCasesFromServiceNow</span><span style=\"color: #24292E\">(</span><span style=\"color: #005CC5\">string</span><span style=\"color: #24292E\"> </span><span style=\"color: #E36209\">fetchFrom</span><span style=\"color: #24292E\">, </span><span style=\"color: #005CC5\">string</span><span style=\"color: #24292E\"> </span><span style=\"color: #E36209\">fetchTill</span><span style=\"color: #24292E\">) </span><span style=\"color: #D73A49\">returns</span><span style=\"color: #24292E\"> CaseData[]</span><span style=\"color: #D73A49\">|error</span><span style=\"color: #24292E\"> {</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #005CC5\">string</span><span style=\"color: #24292E\"> query </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #005CC5\">string</span><span style=\"color: #24292E\"> </span><span style=\"color: #032F62\">`sys_created_onBETWEENjavascript:gs.dateGenerate(${</span><span style=\"color: #24292E\">fetchFrom</span><span style=\"color: #032F62\">})@javascript:gs.dateGenerate(${</span><span style=\"color: #24292E\">fetchTill</span><span style=\"color: #032F62\">})`</span><span style=\"color: #24292E\">;</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    http</span><span style=\"color: #D73A49\">:</span><span style=\"color: #24292E\">Client servicenow </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">check</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">new</span><span style=\"color: #24292E\"> (</span><span style=\"color: #005CC5\">string</span><span style=\"color: #24292E\"> </span><span style=\"color: #032F62\">`https://${</span><span style=\"color: #24292E\">servicenowInstance</span><span style=\"color: #032F62\">}.service-now.com/api/sn_customerservice`</span><span style=\"color: #24292E\">);</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #005CC5\">string</span><span style=\"color: #24292E\"> serviceNowCredentials </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">check</span><span style=\"color: #24292E\"> mime</span><span style=\"color: #D73A49\">:</span><span style=\"color: #6F42C1\">base64Encode</span><span style=\"color: #24292E\">(</span><span style=\"color: #E36209\">serviceNowUsername</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">+</span><span style=\"color: #24292E\"> </span><span style=\"color: #032F62\">&quot;:&quot;</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">+</span><span style=\"color: #24292E\"> </span><span style=\"color: #E36209\">serviceNowPassword</span><span style=\"color: #24292E\">, </span><span style=\"color: #032F62\">&quot;UTF-8&quot;</span><span style=\"color: #24292E\">).</span><span style=\"color: #6F42C1\">ensureType</span><span style=\"color: #24292E\">();</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #D73A49\">record</span><span style=\"color: #24292E\"> {CaseData[] result;} caseResponse </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">check</span><span style=\"color: #24292E\"> servicenow</span><span style=\"color: #D73A49\">-&gt;/</span><span style=\"color: #6F42C1\">case</span><span style=\"color: #24292E\">(</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">        </span><span style=\"color: #E36209\">headers</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> {</span><span style=\"color: #032F62\">&quot;Authorization&quot;</span><span style=\"color: #D73A49\">:</span><span style=\"color: #24292E\"> </span><span style=\"color: #032F62\">&quot;Basic &quot;</span><span style=\"color: #24292E\"> + serviceNowCredentials},</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">        </span><span style=\"color: #E36209\">sysparm_query</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">check</span><span style=\"color: #24292E\"> url</span><span style=\"color: #D73A49\">:</span><span style=\"color: #6F42C1\">encode</span><span style=\"color: #24292E\">(</span><span style=\"color: #E36209\">query</span><span style=\"color: #24292E\">, </span><span style=\"color: #032F62\">&quot;UTF-8&quot;</span><span style=\"color: #24292E\">)</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    );</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #D73A49\">return</span><span style=\"color: #24292E\"> caseResponse.result;</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #D73A49\">function</span><span style=\"color: #24292E\"> </span><span style=\"color: #6F42C1\">addCasesToSalesforce</span><span style=\"color: #24292E\">(</span><span style=\"color: #E36209\">CaseData</span><span style=\"color: #24292E\">[] </span><span style=\"color: #E36209\">cases</span><span style=\"color: #24292E\">) </span><span style=\"color: #D73A49\">returns</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">error?</span><span style=\"color: #24292E\"> {</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    sf</span><span style=\"color: #D73A49\">:</span><span style=\"color: #24292E\">Client salesforce </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">check</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">new</span><span style=\"color: #24292E\"> (</span><span style=\"color: #E36209\">salesforceConfig</span><span style=\"color: #24292E\">);</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #D73A49\">foreach </span><span style=\"color: #24292E\">CaseData caseData </span><span style=\"color: #D73A49\">in</span><span style=\"color: #24292E\"> cases {</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">        </span><span style=\"color: #D73A49\">stream&lt;</span><span style=\"color: #24292E\">Id, </span><span style=\"color: #D73A49\">error?&gt;</span><span style=\"color: #24292E\"> customerQuery </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">check</span><span style=\"color: #24292E\"> salesforce</span><span style=\"color: #D73A49\">-&gt;</span><span style=\"color: #6F42C1\">query</span><span style=\"color: #24292E\">(</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">            </span><span style=\"color: #005CC5\">string</span><span style=\"color: #24292E\"> </span><span style=\"color: #032F62\">`SELECT Id FROM Account WHERE Name = &#39;${</span><span style=\"color: #24292E\">caseData</span><span style=\"color: #032F62\">.</span><span style=\"color: #24292E\">account</span><span style=\"color: #032F62\">.</span><span style=\"color: #24292E\">name</span><span style=\"color: #032F62\">}&#39;`</span><span style=\"color: #24292E\">);</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">        </span><span style=\"color: #D73A49\">record</span><span style=\"color: #24292E\"> {</span><span style=\"color: #D73A49\">|</span><span style=\"color: #24292E\">Id value;</span><span style=\"color: #D73A49\">|</span><span style=\"color: #24292E\">}</span><span style=\"color: #D73A49\">?</span><span style=\"color: #24292E\"> existingCustomer </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">check</span><span style=\"color: #24292E\"> customerQuery.</span><span style=\"color: #6F42C1\">next</span><span style=\"color: #24292E\">();</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">        </span><span style=\"color: #D73A49\">check</span><span style=\"color: #24292E\"> customerQuery.</span><span style=\"color: #6F42C1\">close</span><span style=\"color: #24292E\">();</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">        </span><span style=\"color: #D73A49\">if</span><span style=\"color: #24292E\"> existingCustomer </span><span style=\"color: #D73A49\">is</span><span style=\"color: #24292E\"> () {</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">            log</span><span style=\"color: #D73A49\">:</span><span style=\"color: #6F42C1\">printInfo</span><span style=\"color: #24292E\">(</span><span style=\"color: #032F62\">&quot;Customer not found in Salesforce: &quot;</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">+</span><span style=\"color: #24292E\"> caseData.account.name);</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">            </span><span style=\"color: #D73A49\">continue</span><span style=\"color: #24292E\">;</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">        }</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">        SalesforceCase salesforceCase </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> {</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">            Name</span><span style=\"color: #D73A49\">:</span><span style=\"color: #24292E\"> caseData.number,</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">            Created_on__c</span><span style=\"color: #D73A49\">:</span><span style=\"color: #24292E\"> caseData.sys_created_on,</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">            Priority__c</span><span style=\"color: #D73A49\">:</span><span style=\"color: #24292E\"> caseData.priority,</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">            Account__c</span><span style=\"color: #D73A49\">:</span><span style=\"color: #24292E\"> existingCustomer.value.Id,</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">            Summary__c</span><span style=\"color: #D73A49\">:</span><span style=\"color: #24292E\"> caseData.case</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">        };</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">        _ </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">check</span><span style=\"color: #24292E\"> salesforce</span><span style=\"color: #D73A49\">-&gt;</span><span style=\"color: #6F42C1\">create</span><span style=\"color: #24292E\">(</span><span style=\"color: #032F62\">&quot;Support_Case__c&quot;</span><span style=\"color: #24292E\">, </span><span style=\"color: #E36209\">salesforceCase</span><span style=\"color: #24292E\">);</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    }</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">}</span></span></code></pre>"},"shopify":{"frontmatter":{"title":"Connect Salesforce with e-commerce platforms","description":"E-commerce platforms like Shopify and WooCommerce are the main points of customer interactions. Ballerina can listen for events from such platforms like customer registrations, contact updates, or order placements, and propagate those changes to Salesforce.<br/><br/><i>Example: Update customer records in Salesforce, when customer data is updated in Shopify.</i>","url":"https://github.com/chathurace/integration-samples/blob/main/shopify-customer-to-salesforce-customer/main.bal","image":""},"code":"<pre class=\"shiki github-light\" style=\"background-color: #fff\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #24292E\">sf</span><span style=\"color: #D73A49\">:</span><span style=\"color: #24292E\">Client salesforce </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">check</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">new</span><span style=\"color: #24292E\"> (</span><span style=\"color: #E36209\">salesforceConfig</span><span style=\"color: #24292E\">);</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #D73A49\">service</span><span style=\"color: #24292E\"> </span><span style=\"color: #6F42C1\">/salesforce_bridge</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">on</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">new</span><span style=\"color: #24292E\"> http:Listener(</span><span style=\"color: #005CC5\">9090</span><span style=\"color: #24292E\">) {</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #D73A49\">resource</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">function</span><span style=\"color: #24292E\"> </span><span style=\"color: #6F42C1\">post</span><span style=\"color: #24292E\"> </span><span style=\"color: #6F42C1\">customers</span><span style=\"color: #24292E\">(@</span><span style=\"color: #005CC5\">http</span><span style=\"color: #24292E\">:</span><span style=\"color: #005CC5\">Payload</span><span style=\"color: #24292E\"> </span><span style=\"color: #E36209\">ShopifyCustomer</span><span style=\"color: #24292E\"> </span><span style=\"color: #E36209\">shopifyCustomer</span><span style=\"color: #24292E\">) </span><span style=\"color: #D73A49\">returns</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">error?</span><span style=\"color: #24292E\"> {</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">        SalesforceCustomer salesforceCustomer </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #6F42C1\">transformCustomerData</span><span style=\"color: #24292E\">(</span><span style=\"color: #E36209\">shopifyCustomer</span><span style=\"color: #24292E\">);</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">        </span><span style=\"color: #D73A49\">error?</span><span style=\"color: #24292E\"> e </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #6F42C1\">updateSalesforce</span><span style=\"color: #24292E\">(</span><span style=\"color: #E36209\">salesforceCustomer</span><span style=\"color: #24292E\">);</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">        </span><span style=\"color: #D73A49\">if</span><span style=\"color: #24292E\"> (e </span><span style=\"color: #D73A49\">is</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">error</span><span style=\"color: #24292E\">) {</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">            log</span><span style=\"color: #D73A49\">:</span><span style=\"color: #6F42C1\">printError</span><span style=\"color: #24292E\">(</span><span style=\"color: #032F62\">&quot;Error occurred while updating Salesforce for customer: &quot;</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">+</span><span style=\"color: #24292E\"> salesforceCustomer.</span><span style=\"color: #6F42C1\">toJsonString</span><span style=\"color: #24292E\">(), </span><span style=\"color: #E36209\">e</span><span style=\"color: #24292E\">);</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">            </span><span style=\"color: #D73A49\">return</span><span style=\"color: #24292E\"> e;</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">        }</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    }</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #D73A49\">function</span><span style=\"color: #24292E\"> </span><span style=\"color: #6F42C1\">transformCustomerData</span><span style=\"color: #24292E\">(</span><span style=\"color: #E36209\">ShopifyCustomer</span><span style=\"color: #24292E\"> </span><span style=\"color: #E36209\">shopifyCustomer</span><span style=\"color: #24292E\">) </span><span style=\"color: #D73A49\">returns</span><span style=\"color: #24292E\"> SalesforceCustomer {</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #005CC5\">string</span><span style=\"color: #24292E\"> firstName </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> shopifyCustomer.first_name </span><span style=\"color: #D73A49\">?:</span><span style=\"color: #24292E\"> regex</span><span style=\"color: #D73A49\">:</span><span style=\"color: #6F42C1\">split</span><span style=\"color: #24292E\">(shopifyCustomer.email, </span><span style=\"color: #032F62\">&quot;@&quot;</span><span style=\"color: #24292E\">)[</span><span style=\"color: #005CC5\">0</span><span style=\"color: #24292E\">];</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #005CC5\">string</span><span style=\"color: #24292E\"> lastName </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> shopifyCustomer.last_name </span><span style=\"color: #D73A49\">?:</span><span style=\"color: #24292E\"> </span><span style=\"color: #032F62\">&quot;&quot;</span><span style=\"color: #24292E\">;</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #005CC5\">string</span><span style=\"color: #24292E\"> address </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #032F62\">&quot;&quot;</span><span style=\"color: #24292E\">;</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    Address</span><span style=\"color: #D73A49\">?</span><span style=\"color: #24292E\"> shopifyAddress </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> shopifyCustomer.default_address;</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #D73A49\">if</span><span style=\"color: #24292E\"> shopifyAddress </span><span style=\"color: #D73A49\">!is</span><span style=\"color: #24292E\"> () {</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">        address </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #005CC5\">string</span><span style=\"color: #24292E\"> </span><span style=\"color: #032F62\">`${</span><span style=\"color: #24292E\">shopifyAddress</span><span style=\"color: #032F62\">.</span><span style=\"color: #24292E\">address1</span><span style=\"color: #032F62\">}, ${</span><span style=\"color: #24292E\">shopifyAddress</span><span style=\"color: #032F62\">.</span><span style=\"color: #24292E\">address2</span><span style=\"color: #032F62\">}, ${</span><span style=\"color: #24292E\">shopifyAddress</span><span style=\"color: #032F62\">.</span><span style=\"color: #24292E\">city</span><span style=\"color: #032F62\">}, ${</span><span style=\"color: #24292E\">shopifyAddress</span><span style=\"color: #032F62\">.</span><span style=\"color: #24292E\">country</span><span style=\"color: #032F62\">}`</span><span style=\"color: #24292E\">;</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    }</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    SalesforceCustomer salesforceCustomer </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> {</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">        Name</span><span style=\"color: #D73A49\">:</span><span style=\"color: #24292E\"> string </span><span style=\"color: #032F62\">`${</span><span style=\"color: #24292E\">firstName</span><span style=\"color: #032F62\">} ${</span><span style=\"color: #24292E\">lastName</span><span style=\"color: #032F62\">}`</span><span style=\"color: #24292E\">,</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">        Email__c</span><span style=\"color: #D73A49\">:</span><span style=\"color: #24292E\"> shopifyCustomer.email,</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">        Address__c</span><span style=\"color: #D73A49\">:</span><span style=\"color: #24292E\"> address</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    };</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #D73A49\">return</span><span style=\"color: #24292E\"> salesforceCustomer;</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #D73A49\">function</span><span style=\"color: #24292E\"> </span><span style=\"color: #6F42C1\">updateSalesforce</span><span style=\"color: #24292E\">(</span><span style=\"color: #E36209\">SalesforceCustomer</span><span style=\"color: #24292E\"> </span><span style=\"color: #E36209\">sfCustomer</span><span style=\"color: #24292E\">) </span><span style=\"color: #D73A49\">returns</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">error?</span><span style=\"color: #24292E\"> {</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #D73A49\">stream&lt;</span><span style=\"color: #24292E\">Id, </span><span style=\"color: #D73A49\">error?&gt;</span><span style=\"color: #24292E\"> customerQuery </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">check</span><span style=\"color: #24292E\"> salesforce</span><span style=\"color: #D73A49\">-&gt;</span><span style=\"color: #6F42C1\">query</span><span style=\"color: #24292E\">(</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">            </span><span style=\"color: #005CC5\">string</span><span style=\"color: #24292E\"> </span><span style=\"color: #032F62\">`SELECT Id FROM HmartCustomer__c WHERE Email__c = &#39;${</span><span style=\"color: #24292E\">sfCustomer</span><span style=\"color: #032F62\">.</span><span style=\"color: #24292E\">Email__c</span><span style=\"color: #032F62\">}&#39;`</span><span style=\"color: #24292E\">);</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #D73A49\">record</span><span style=\"color: #24292E\"> {</span><span style=\"color: #D73A49\">|</span><span style=\"color: #24292E\">Id value;</span><span style=\"color: #D73A49\">|</span><span style=\"color: #24292E\">}</span><span style=\"color: #D73A49\">?</span><span style=\"color: #24292E\"> existingCustomer </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">check</span><span style=\"color: #24292E\"> customerQuery.</span><span style=\"color: #6F42C1\">next</span><span style=\"color: #24292E\">();</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #D73A49\">check</span><span style=\"color: #24292E\"> customerQuery.</span><span style=\"color: #6F42C1\">close</span><span style=\"color: #24292E\">();</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    </span><span style=\"color: #D73A49\">if</span><span style=\"color: #24292E\"> existingCustomer </span><span style=\"color: #D73A49\">is</span><span style=\"color: #24292E\"> () {</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">        _ </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">check</span><span style=\"color: #24292E\"> salesforce</span><span style=\"color: #D73A49\">-&gt;</span><span style=\"color: #6F42C1\">create</span><span style=\"color: #24292E\">(</span><span style=\"color: #032F62\">&quot;HmartCustomer__c&quot;</span><span style=\"color: #24292E\">, </span><span style=\"color: #E36209\">sfCustomer</span><span style=\"color: #24292E\">);</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    } </span><span style=\"color: #D73A49\">else</span><span style=\"color: #24292E\"> {</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">        </span><span style=\"color: #D73A49\">check</span><span style=\"color: #24292E\"> salesforce</span><span style=\"color: #D73A49\">-&gt;</span><span style=\"color: #6F42C1\">update</span><span style=\"color: #24292E\">(</span><span style=\"color: #032F62\">&quot;HmartCustomer__c&quot;</span><span style=\"color: #24292E\">, existingCustomer.value.Id, </span><span style=\"color: #E36209\">sfCustomer</span><span style=\"color: #24292E\">);</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">    }</span></span>\n<span class=\"line\"><span style=\"color: #24292E\">}</span></span></code></pre>"}}},"__N_SSG":true}